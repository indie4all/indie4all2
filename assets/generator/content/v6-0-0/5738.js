(self.webpackChunkCDN=self.webpackChunkCDN||[]).push([[5738],{37182:(e,t,n)=>{var i=n(93633);function __default(e){return e&&(e.__esModule?e.default:e)}e.exports=(i.default||i).template({1:function(e,t,n,i,o){return"47%"},3:function(e,t,n,i,o){return"25%"},5:function(e,t,n,i,o){return'<i class="fa fa-spinner fa-spin fa-3x" aria-hidden="true"></i>'},7:function(e,t,n,i,o){return'<i class="fa fa-exclamation-triangle fa-3x" aria-hidden="true"></i>'},compiler:[8,">= 4.3.0"],main:function(e,t,i,o,s){var r,a,l=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="cargando" \r\n  style="height:100%; width:100%; position: absolute; z-index: 10000; background-color: rgba(0, 0, 0, 0.5); top: 0;">\r\n  <div class="text-center" style="position: absolute; top: 30%; \r\n    left:'+(null!=(r=__default(n(6088)).call(l,null!=t?c(t,"status"):t,"loading",{name:"ifeq",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s,loc:{start:{line:4,column:9},end:{line:4,column:47}}}))?r:"")+(null!=(r=__default(n(20884)).call(l,null!=t?c(t,"status"):t,"loading",{name:"ifneq",hash:{},fn:e.program(3,s,0),inverse:e.noop,data:s,loc:{start:{line:4,column:47},end:{line:4,column:87}}}))?r:"")+';">\r\n    '+(null!=(r=__default(n(6088)).call(l,null!=t?c(t,"status"):t,"loading",{name:"ifeq",hash:{},fn:e.program(5,s,0),inverse:e.noop,data:s,loc:{start:{line:5,column:4},end:{line:5,column:101}}}))?r:"")+"\r\n    "+(null!=(r=__default(n(6088)).call(l,null!=t?c(t,"status"):t,"error",{name:"ifeq",hash:{},fn:e.program(7,s,0),inverse:e.noop,data:s,loc:{start:{line:6,column:4},end:{line:6,column:104}}}))?r:"")+'\r\n    <p class="white" style="color:white;"><strong>'+e.escapeExpression("function"==typeof(a=null!=(a=c(i,"message")||(null!=t?c(t,"message"):t))?a:e.hooks.helperMissing)?a.call(l,{name:"message",hash:{},data:s,loc:{start:{line:7,column:50},end:{line:7,column:61}}}):a)+"</strong></p>\r\n  </div>\r\n</div>"},useData:!0})},5738:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var i=n(65360),o=n(7979),s=n(93113),r=n(25715),a=n(96107),l=n(75015),c=n(35999),__decorate=function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let d=class VideoAnalyticsService{constructor(e){this.PAUSE_THRESHOLD=2,this.analyticsSubject=new a.B,this.analyticsEvent$=this.analyticsSubject.asObservable(),this.ranges={},e.getInteractions(l.SB).subscribe((e=>{if(this.ranges[e.id]||(this.ranges[e.id]=[]),0==this.ranges[e.id].length)return void this.ranges[e.id].push({start:e.time,end:e.time});const t=this.ranges[e.id][this.ranges[e.id].length-1];Math.abs(t.end-e.time)>.5?this.ranges[e.id].push({start:e.time,end:e.time}):t.end=e.time})),e.getInteractions(l.Ym).subscribe((e=>{if(!this.ranges[e.id]||!this.ranges[e.id].length)return;const t=this.ranges[e.id][this.ranges[e.id].length-1],n=e.time;Math.abs(t.end-n)>this.PAUSE_THRESHOLD||(this.analyticsSubject.next({id:e.id,type:e.type,title:e.description,duration:e.duration,ranges:this.ranges[e.id]}),this.ranges[e.id]=[])})),e.getInteractions(l.Hc).subscribe((e=>{this.ranges[e.id]&&this.ranges[e.id].length&&(this.analyticsSubject.next({id:e.id,type:e.type,title:e.description,duration:e.duration,ranges:this.ranges[e.id]}),this.ranges[e.id]=[])}))}get events(){return this.analyticsEvent$}};d=__decorate([(0,i.k)({global:!0}),__metadata("design:paramtypes",[c.A])],d);const u=d;var h=n(37182),f=n.n(h),progress_interoperability_service_decorate=function(e,t,n,i){var o,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(s<3?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},progress_interoperability_service_metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__awaiter=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function fulfilled(e){try{step(i.next(e))}catch(e){s(e)}}function rejected(e){try{step(i.throw(e))}catch(e){s(e)}}function step(e){e.done?o(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())}))};let p=class ProgressInteroperabilityService extends r.default{constructor(e,t,n){super(e),this.objService=e,this.bootstrap=t,this.videoAnalytics=n}onError(e){if(console.error("Error:",e),401===e.status)return void this.modal.hide();const t=400===e.status?"ADVERTENCIA: ¡TIENES UNA UNIDAD DE EVALUACIÓN ABIERTA!":"ERROR: SESIÓN CADUCADA. DEBES ENTRAR NUEVAMENTE EN EL AULA VIRTUAL Y LANZAR LA UNIDAD.";this.modalElem.innerHTML=f()({message:t,status:"error"}),this.modal.show()}resume(){return __awaiter(this,void 0,void 0,(function*(){this.keepAliveIntervalId||(this.keepAliveIntervalId=setInterval(this.keepAlive,6e5));const e=yield fetch("../../contentunit/php/funcioneslaltiv4.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({function:0})});e.ok?this.modal.hide():this.onError(e)}))}pause(){return __awaiter(this,void 0,void 0,(function*(){this.keepAliveIntervalId&&clearInterval(this.keepAliveIntervalId),this.keepAliveIntervalId=null,yield fetch("../../contentunit/php/funcioneslaltiv4.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({function:1}),keepalive:!0})}))}keepAlive(){return __awaiter(this,void 0,void 0,(function*(){const e=yield fetch("../../contentunit/php/funcioneslaltiv4.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({function:5})});e.ok?this.modal.hide():this.onError(e)}))}startGame(e,t,n){return __awaiter(this,void 0,void 0,(function*(){const i=yield fetch("../../contentunit/php/funcionesGamev3.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idunidad:e,idwidget:t,origin:n})});if(!i.ok)return void this.onError(i);const o="https://game.upct.es/"+(yield i.json()).codgame+"/teacher/";location.replace(o)}))}init(){const e=Object.create(null,{init:{get:()=>super.init}});return __awaiter(this,void 0,void 0,(function*(){e.init.call(this);const t=JSON.parse(document.body.dataset.objectives);t&&(t.flat().filter((e=>100==e.percentage)).forEach((e=>this.markObjectiveAsCompleted(e.id))),this.redraw()),this.modalModule=yield this.bootstrap.loadModalModule(),this.modalElem=document.getElementById("sharedModal"),this.modal=this.modalModule.getOrCreateInstance(this.modalElem),this.modalElem.addEventListener("hidden.bs.modal",(()=>{this.modalElem.innerHTML=""})),this.videoAnalytics.events.subscribe((e=>__awaiter(this,void 0,void 0,(function*(){const t=yield fetch("../../contentunit/php/funcioneslaltiv4.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({function:2,element:`objetivo${e.id}`,namevideo:e.title,notes:JSON.stringify({video:[{Type:"Range",Ranges:e.ranges,Duration:e.duration}]})})});t.ok||this.onError(t)})))),this.objService.events.subscribe((e=>__awaiter(this,void 0,void 0,(function*(){const t="objetivo"+e.id,n={"Content-Type":"application/json"};this.markObjectiveAsCompleted(t),this.redraw();const i=yield fetch("../../contentunit/php/funcionesobjetivoltiv5.php",{method:"POST",headers:n,body:JSON.stringify({objetivo:{id:t,nombre:e.description}})});if(!i.ok)return void this.onError(i);const o=yield fetch("../../contentunit/php/funcioneslaltiv4.php",{method:"POST",headers:n,body:JSON.stringify({function:3,element:t,notes:e.type,namevideo:e.description})});o.ok||this.onError(o)})))),document.addEventListener("visibilitychange",(()=>__awaiter(this,void 0,void 0,(function*(){"hidden"===document.visibilityState?yield this.pause():yield this.resume()})))),this.resume()}))}};p=progress_interoperability_service_decorate([(0,i.k)({global:!0}),progress_interoperability_service_metadata("design:paramtypes",[s.A,o.A,u])],p);const m=p},6088:(e,t,n)=>{"use strict";function __WEBPACK_DEFAULT_EXPORT__(e,t,n){if(e==t)return n.fn(this)}n.r(t),n.d(t,{default:()=>__WEBPACK_DEFAULT_EXPORT__})},20884:(e,t,n)=>{"use strict";function __WEBPACK_DEFAULT_EXPORT__(e,t,n){if(e!=t)return n.fn(this)}n.r(t),n.d(t,{default:()=>__WEBPACK_DEFAULT_EXPORT__})}}]);