!function(){const i=io("http://cpcdpruebas.upct.es:3000",{forceNew:!0});var t=window.location.pathname.split("/");const o=t[t.length-2],s=o+"-username",c=o+"-uuid",d=o+"-date";let m=0,l=JSON.parse(sessionStorage.getItem(s));l||window.location.replace("index.html");let g=JSON.parse(sessionStorage.getItem(c))||([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16));sessionStorage.setItem(c,JSON.stringify(g));let f=sessionStorage.getItem(d)||Date.now();i.emit("join-room",o,g,{username:l});function n(t,r){function n(){$(".gamification-steps").find(".gamification-current-step").each(function(){const t=$(this).parent();$(this).removeClass("gamification-current-step"),t.children().eq(m).addClass("gamification-current-step")})}function a(o,s){let e=$("#gamification-message-modal");function n(t){t.find(".gamification-ranking").remove();let e=function(t,o){t.sort((t,e)=>e.total-t.total);var e=t.map((t,e)=>2<e&&t!==o?{...t,username:"***"}:t).map(function(t,e){var n=$("<td />").html(e+1),a=$("<td />").html(t.username),i=$("<td />").html(t.points),e=$("<td />").html(t.total);return $("<tr />").toggleClass("current",t===o).append(n,a,i,e)}),n=$("<tr />").append($("<th />").attr("colspan",4).html(r("gamification-results"))),t=$("<tr />").append($("<th />").html(r("gamification-position")),$("<th />").html(r("gamification-username")),$("<th />").html(r("gamification-points")),$("<th />").html(r("gamification-total"))),t=$("<thead />").append(n,t),e=$("<tbody />").html(e);return $("<table/>").addClass("gamification-ranking table mx-auto").append(t,e)}(o,s);var n=s&&s.res?"https://cdn-cpcd-upct-e2bdhub5efg7c9hk.z01.azurefd.net/$web/img/gamy-correct.png":"https://cdn-cpcd-upct-e2bdhub5efg7c9hk.z01.azurefd.net/$web/img/gamy-wrong.png",a=s&&s.res?r("TextCorrectAnswer"):r("TextIncorrectAnswer"),i=s&&s.res?r("GamyCorrect"):r("GamyWrong");t.find(".modal-title").html(a),t.find(".modal-logo-img").attr("src",n).attr("alt",i),t.find(".modal-body").append(e),e.delay(1500).show(700),setTimeout(function(){t.removeClass("changing")},100)}if(e.hasClass("show")){let t=e.clone();e.css("opacity",0),setTimeout(function(){e.remove()},300),t.addClass("changing"),n(t),bootstrap.Modal.getOrCreateInstance(t[0],{keyboard:!0,focus:!0,backdrop:!1}).show();const a=t[0].addEventListener("hidden.bs.modal",function(){$(".gamification-current-step").first().attr("tabindex","-1").focus(),t[0].removeEventListener("hidden.bs.modal",a)})}else{e.addClass("changing"),n(e),bootstrap.Modal.getOrCreateInstance(e[0],{keyboard:!0,focus:!0,backdrop:!1}).show();const t=e[0].addEventListener("hidden.bs.modal",function(){$(".gamification-current-step").first().attr("tabindex","-1").focus(),e[0].removeEventListener("hidden.bs.modal",t)})}}i.on("ack",t=>{m=t.step,n()}),i.on("next-activity",(t,e)=>{m=e,a(t,t.find(t=>t.id===g)),n()}),i.on("stop-activity",()=>{$(".btn-gamification:visible").attr("disabled",!0)}),i.on("redirect-game-finished",t=>{sessionStorage.removeItem(s),sessionStorage.removeItem(c),sessionStorage.removeItem(d);var e=t.find(t=>t.id===g);a(t,e)}),$(document).on("gamificate",".btn-gamification",function(t,e,n){let a=$("#gamification-message-modal");a.find(".modal-title").html(r("AnswerSent")),a.find(".modal-logo-img").attr("src","https://cdn-cpcd-upct-e2bdhub5efg7c9hk.z01.azurefd.net/$web/img/gamy-ok.png").attr("alt",r("GamyGreeting")),a.find(".gamification-ranking").remove(),bootstrap.Modal.getOrCreateInstance(a[0],{keyboard:!0,focus:!0,backdrop:!1}).show(),$(this).attr("disabled",!0),i.emit("question-response",{id:g,res:e,username:l,room:o,time:Date.now()-f,score:n,step:m})}),n()}let a=document.currentScript.src;a=a.substr(0,a.lastIndexOf("/")),$(document).ready(function(){setTimeout(function(){$(".btn-gamification").attr("aria-haspopup","dialog")},500);let e=$("html").attr("lang");fetch(`${a}/../languages/${e}.json`).then(t=>t.json()).then(t=>i18next.createInstance({lng:e,resources:{[e]:{translation:t}}},n))})}();