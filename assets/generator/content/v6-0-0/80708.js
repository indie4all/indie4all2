"use strict";(self.webpackChunkCDN=self.webpackChunkCDN||[]).push([[80708],{98057:(t,e,s)=>{s.r(e),s.d(e,{default:()=>S});var i=s(16492),n=s(75015),o=s(73938),r=s(16126),c=s(97523),a=s(35999),h=s(28147),d=s(57835),u=s(5513),l=s.n(u);class SentenceOrderItemGamificationElement extends d.A{constructor(t,e,s){super(t,e),this.i18n=t,this.utils=e,this.data=s}init(t){super.init(t);const e=this.sentence.querySelector(".source-words"),s=this.data.words.map(((t,e)=>l()({id:this.id,pos:e,word:t})));this.utils.shuffle(this.data.words),e.querySelectorAll("td").forEach(((t,e)=>t.innerHTML=s[e]))}check(){}reset(){this.coordinates=[0,0],this.sentence.querySelectorAll(".drag-word-item").forEach((t=>{t.setAttribute("tabindex",""===t.textContent?"-1":""),t.classList.remove("focused")}));const t=Array.from(this.sentence.querySelectorAll(".word-item"));t.forEach(((t,e)=>t.setAttribute("tabindex",0===e?"0":"-1"))),this.sentence.querySelectorAll(".source-words").forEach((e=>{e.querySelectorAll("td").forEach(((e,s)=>e.append(t[s])))}))}get score(){const t=Array.from(this.sentence.querySelectorAll(".target-words .word-item")).map((t=>this.data.words[t.dataset.position]));return this.data.solutions.some((e=>e.split(/\s+/).every(((e,s)=>e===t[s]))))?1:0}}var f=s(70583),p=s(61709),m=s(48483),g=s(50667),y=s(83034),__decorate=function(t,e,s,i){var n,o=arguments.length,r=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(r=(o<3?n(r):o>3?n(e,s,r):n(e,s))||r);return o>3&&r&&Object.defineProperty(e,s,r),r},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let v=class SentenceOrderGamificationElement extends h.A{constructor(t,e,s,i,n,o,r){super(s,e,t,r),this.i18n=t,this.utils=e,this.voiceControl=s,this.interaction=i,this.gamification=n,this.contentService=o,this.alert=r}async init(){await super.init(),this.solutions=await this.contentService.get(this.id),this.sentences=Array.from(this.widget.querySelectorAll(".widget-sentence-order-item")).map(((t,e)=>{const s=new SentenceOrderItemGamificationElement(this.i18n,this.utils,this.solutions[e]);return s.init(t),s})),this.gamification.gamificationEvents.pipe((0,r.p)((t=>t instanceof o.an))).subscribe((t=>{const e=this.widget.querySelector(".btn-check-answer");e.checkVisibility&&(e.disabled=!0)})),console.debug("[SentenceOrder] Initialized")}check(){const t=this.sentences.map((t=>t.score)),e=t.reduce(((t,e)=>t+e),0)/t.length;this.interaction.emit(new n.sV({id:this.id,type:this.type,description:this.description,score:e})),1===e&&this.interaction.emit(new n.yz({id:this.id,type:this.type,description:this.description}));this.widget.querySelector(".btn-check-answer").disabled=!0}reset(){this.sentences.forEach((t=>t.reset()))}};v=__decorate([(0,i.x)({selector:".widget-sentence-order"}),__metadata("design:paramtypes",[y.A,f.A,p.A,a.A,c.default,m.A,g.A])],v);const S=v},48483:(t,e,s)=>{s.d(e,{A:()=>r});var i=s(65360),n=s(70583),__decorate=function(t,e,s,i){var n,o=arguments.length,r=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(r=(o<3?n(r):o>3?n(e,s,r):n(e,s))||r);return o>3&&r&&Object.defineProperty(e,s,r),r},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let o=class ContentService{constructor(t){this.utils=t,this.loading=!1}async get(t){for(;this.loading;)await this.utils.sleep(100);if(this.content||(this.loading=!0,this.content=await fetch("./content.json").then((t=>t.json())),this.loading=!1),!this.content[t])throw new Error(`Widget ${t} not found`);return JSON.parse(this.utils.b64DecodeUnicode(this.content[t]))}};o=__decorate([(0,i.k)({global:!0}),__metadata("design:paramtypes",[n.A])],o);const r=o},97523:(t,e,s)=>{s.d(e,{default:()=>h});var i=s(65360),n=s(27291),o=s(94442),r=s(37115),c=s(35999),__decorate=function(t,e,s,i){var n,o=arguments.length,r=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(r=(o<3?n(r):o>3?n(e,s,r):n(e,s))||r);return o>3&&r&&Object.defineProperty(e,s,r),r},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let a=class GamificationService{constructor(t){this.interaction=t,this._code="test",this._scoresHistory=[],this.gamificationSubject=new n.B,this.gamificationEvents$=this.gamificationSubject.asObservable(),this.studentsChangedSubject=new o.m(1),this.studentsChanged$=this.studentsChangedSubject.asObservable()}get gamificationEvents(){return this.gamificationEvents$}get finalScores(){const t=this.scoresHistory[this.step],e=this.students.map((e=>{const s=t.find((t=>t.id===e.id)),i=this.scoresHistory.map((t=>{var s;return(null===(s=t.find((t=>t.id===e.id)))||void 0===s?void 0:s.points)||0})).reduce(((t,e)=>t+e),0);return{id:e.id,name:e.name,time:(null==s?void 0:s.time)||0,points:(null==s?void 0:s.points)||0,correct:(null==s?void 0:s.correct)||!1,total:i}}));return e.sort(((t,e)=>e.total-t.total)),e}get scoresHistory(){return this._scoresHistory||(this._scoresHistory=JSON.parse(sessionStorage.getItem(this._code+"-scores"))||[]),this._scoresHistory}set scoresHistory(t){this._scoresHistory=t,sessionStorage.setItem(this._code+"-scores",JSON.stringify(t))}get activity(){return this._activity}set activity(t){this._activity=t}get code(){return this._code}set code(t){this._code=t}get user(){return this._user||(this._user=JSON.parse(sessionStorage.getItem(this._code+"-user"))),this._user}set user(t){this._user=t,sessionStorage.setItem(this._code+"-user",JSON.stringify(t))}get socket(){return this._socket}set socket(t){this._socket=t}get step(){return"number"!=typeof this._step&&(this._step=JSON.parse(sessionStorage.getItem(this._code+"-step"))||0),this._step}set step(t){this._step=t,sessionStorage.setItem(this._code+"-step",JSON.stringify(t))}get students(){return this._students||(this._students=JSON.parse(sessionStorage.getItem(this._code+"-students"))||[],this.studentsChangedSubject.next(this._students)),this._students.forEach((t=>{var e;return t.answered=void 0!==(null===(e=this.scoresHistory[this.step])||void 0===e?void 0:e.find((e=>e.id===t.id))),t})),this._students}set students(t){this._students=t,sessionStorage.setItem(this._code+"-students",JSON.stringify(t)),this.studentsChangedSubject.next(t)}get studentsChanged(){return this.studentsChanged$}join(){this._socket.emit("join-room",this._code,this.user.id,{username:this.user.name})}async init(){this._socket="MISSING_ENV_VAR".GAMIFICATION_SERVER?(0,r.io)("MISSING_ENV_VAR".GAMIFICATION_SERVER,{forceNew:!0}):(0,r.io)({forceNew:!0})}};a=__decorate([(0,i.k)({global:!0}),__metadata("design:paramtypes",[c.A])],a);const h=a},73938:(t,e,s)=>{s.d(e,{$Y:()=>GamificationResultEvent,an:()=>GamificationTeacherStopEvent,aq:()=>GamificationTeacherFinishedEvent,tS:()=>GamificationTeacherAckEvent,wU:()=>GamificationTeacherNextActivityEvent});class GamificationEvent{}class GamificationTeacherAckEvent extends GamificationEvent{get step(){return this._step}set step(t){this._step=t}get questions(){return this._questions}set questions(t){this._questions=t}}class GamificationTeacherStopEvent extends GamificationEvent{}class GamificationResultEvent{constructor(t=[]){this._info=t}get info(){return this._info}}class GamificationTeacherNextActivityEvent extends GamificationResultEvent{}class GamificationTeacherFinishedEvent extends GamificationResultEvent{}}}]);