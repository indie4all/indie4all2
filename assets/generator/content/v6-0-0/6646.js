"use strict";(self.webpackChunkCDN=self.webpackChunkCDN||[]).push([[6646],{16492:(t,e,i)=>{i.d(e,{x:()=>Widget});var o=i(7181),n=i(40561);function Widget(t){const e=o.Ay.get(n.default);return function(i){e.registerWidget(t.selector,i)}}},19412:(t,e,i)=>{i.d(e,{A:()=>Element});var o=i(16126),n=i(3605),__awaiter=function(t,e,i,o){return new(i||(i=Promise))((function(n,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?n(t.value):function adopt(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,e||[])).next())}))};class Element{constructor(t,e,i){this.voiceControl=t,this.utils=e,this.i18n=i,this._activityNumber=0}init(){return __awaiter(this,void 0,void 0,(function*(){if(!this._widget)throw new Error("ElementHTML widget has not been set.");this.voiceControlMessageElem=this.widget.querySelector(".tta-message"),this.voiceControlButton=document.querySelector(`#speech-to-action-${this.id}`),this.voiceControlButton&&(this.voiceControlButton.addEventListener("click",(()=>{if(this.voiceControl.currentTarget!==this.id){for(;this.voiceControl.numTargets>1;)this.voiceControl.popTarget();return this._parent&&this.voiceControl.addTarget(this._parent.id),void this.voiceControl.addTarget(this.id)}this.voiceControl.popTarget(),this.voiceControlButton&&this.toggleVoiceControlButton(!1)})),this.voiceControl.voiceControlTargetChanged.subscribe((t=>{this.id===t.old&&this.toggleVoiceControlButton(!1),this.id===t.new&&this.toggleVoiceControlButton(!0)})),this.voiceControl.voiceControlActions.pipe((0,o.p)((t=>t.target===this.id))).subscribe((t=>{t instanceof n.m6?this.voiceControlStart():t instanceof n.$q?this.voiceControlFinish():t instanceof n.DZ?this.voiceControlNext():t instanceof n.vZ?this.voiceControlPrevious():t instanceof n.Fd?this.voiceControlGoto(t.position):t instanceof n.V3?this.voiceControlBack():t instanceof n.gZ?this.voiceControlSelect():t instanceof n.CG?this.voiceControlClose():t instanceof n.sT?this.voiceControlCheck():t instanceof n.XR?this.voiceControlCurrent():t instanceof n.B$?this.voiceControlDelete():t instanceof n._R?this.voiceControlMaximize():t instanceof n.EZ?this.voiceControlMinimize():t instanceof n.$V?this.voiceControlMove(t.position):t instanceof n.ow?this.voiceControlPause():t instanceof n.OR?this.voiceControlPlay():t instanceof n.pr?this.voiceControlRepeat():t instanceof n.lR?this.voiceControlReset():t instanceof n.m6?this.voiceControlStart():t instanceof n.o3?this.voiceControlStop():t instanceof n.HU?this.voiceControlWrite(t.text):t instanceof n.kw&&this.voiceControlUnknown()})))}))}get description(){return this.widget.dataset.desc||""}get id(){return this.widget.id}get type(){return this.widget.dataset.type||""}get widget(){return this._widget}set widget(t){this._widget=t}get parent(){return this._parent}set parent(t){this._parent=t}set activityNumber(t){this._activityNumber=t,this.voiceControlButton&&(this.voiceControlButton.innerHTML+=`<span class="element-number">${this.i18n.value("tta-activity-number")} ${t}</span>`)}toggleHighlight(t){this.widget.classList.toggle("speech-focused",t)}toggleVoiceControlButton(t){if(this.voiceControlButton){const e=this.voiceControlButton.querySelector("svg");e&&(e.classList.toggle("fa-head-side-cough",t),e.classList.toggle("fa-head-side-cough-slash",!t))}}showVoiceControlButton(){this.voiceControlButton&&(this.voiceControlButton.classList.add("show"),this.toggleVoiceControlButton(!1))}hideVoiceControlButton(){this.voiceControlButton&&this.voiceControlButton.classList.remove("show")}voiceControlStart(){this.toggleVoiceControlButton(!0)}voiceControlFinish(){this.voiceControl.popTarget(),this.toggleVoiceControlButton(!1)}voiceControlClose(){this.voiceControlUnknown()}voiceControlCheck(){this.voiceControlUnknown()}voiceControlCurrent(){this.voiceControlUnknown()}voiceControlDelete(){this.voiceControlUnknown()}voiceControlMaximize(){this.voiceControlUnknown()}voiceControlMinimize(){this.voiceControlUnknown()}voiceControlMove(t){this.voiceControlUnknown()}voiceControlPause(){this.voiceControlUnknown()}voiceControlPlay(){this.voiceControlUnknown()}voiceControlRepeat(){this.voiceControlUnknown()}voiceControlReset(){this.voiceControlUnknown()}voiceControlStop(){this.voiceControlUnknown()}voiceControlWrite(t){this.voiceControlUnknown()}voiceControlNext(){this.voiceControlUnknown()}voiceControlPrevious(){this.voiceControlUnknown()}voiceControlGoto(t){this.voiceControlUnknown()}voiceControlBack(){this.voiceControlUnknown()}voiceControlSelect(){this.voiceControlUnknown()}voiceControlUnknown(){this.voiceControlMessageElem.innerHTML+=this.utils.alert("alert-danger",this.i18n.value("tta-error-message"))}}},66646:(t,e,i)=>{i.r(e),i.d(e,{default:()=>u});var o=i(16492),n=i(75015),s=i(19412),r=i(44295),l=i(35999),a=i(70583),__awaiter=function(t,e,i,o){return new(i||(i=Promise))((function(n,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?n(t.value):function adopt(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,e||[])).next())}))};class VimeoPlayer{constructor(t,e,i,o){this.i18n=t,this.id=e,this.videoId=i,this.defaultCaptions=o,this.loaded=!1}load(){return __awaiter(this,void 0,void 0,(function*(){const{default:t}=yield i.e(2273).then(i.bind(i,72273)),e={id:parseInt(this.videoId),loop:!1,byline:!1,responsive:!0,title:!1,portrait:!1,playsinline:!0,muted:!1,speed:!0};this.player=new t("player-"+this.id,e),this.player.disableTextTrack(),this.defaultCaptions&&this.player.getTextTracks().then((t=>{if(!t.length)return;let e=t.find((t=>t.language.startsWith(this.i18n.getLang())));e?this.player.enableTextTrack(e.language,"captions"):console.error("Text track not found: "+this.i18n.getLang())})),this.loaded=!0}))}play(){this.player.play()}stop(){this.player.pause(),this.player.setCurrentTime(0)}pause(){this.player.pause()}set onLoad(t){this.player.on("loaded",t)}onEvent(t,e){this.player.on(t,(t=>{const i=t.duration,o=t.seconds;e(i,o)}))}set onPlay(t){this.onEvent("play",t)}set onPause(t){this.onEvent("pause",t)}set onEnded(t){this.onEvent("ended",t)}set onTimeUpdate(t){this.onEvent("timeupdate",t)}}var c,h=i(61709);!function(t){t[t.UNSTARTED=-1]="UNSTARTED",t[t.ENDED=0]="ENDED",t[t.PLAYING=1]="PLAYING",t[t.PAUSED=2]="PAUSED",t[t.BUFFERING=3]="BUFFERING",t[t.CUED=5]="CUED"}(c||(c={}));var youtube_player_awaiter=function(t,e,i,o){return new(i||(i=Promise))((function(n,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?n(t.value):function adopt(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,e||[])).next())}))};class YTPlayer{constructor(t,e,i){this.id=t,this.videoId=e,this.defaultCaptions=i,this.loaded=!1}loadCaptions(){return youtube_player_awaiter(this,void 0,void 0,(function*(){if(this.defaultCaptions){(yield this.player.getOptions("captions")).length&&(this.player.setOption("captions","reload",!0),this.defaultCaptions=!1)}}))}load(){return youtube_player_awaiter(this,void 0,void 0,(function*(){const{default:t}=yield i.e(3517).then(i.t.bind(i,23517,23));let e=this.videoId.split("/embed/")[1],o=e.split("?")[0],n=e.split("?")[1].split("&"),s={videoId:o,height:"auto",width:"100%",playerVars:{start:parseInt(n[0].split("=")[1])}};n.length>1&&(s.playerVars.end=parseInt(n[1].split("=")[1])),this.player=t("player-"+this.id,s),this.player.on("stateChange",(t=>this.loadCaptions())),this.loaded=!0}))}play(){this.player.playVideo()}stop(){this.player.stopVideo()}pause(){this.player.pauseVideo()}onState(t,e){this.player.on("stateChange",(i=>youtube_player_awaiter(this,void 0,void 0,(function*(){const o=i.data,n=yield this.player.getDuration(),s=yield this.player.getCurrentTime();o===t&&e(n,s)}))))}set onLoad(t){this.player.on("ready",t)}set onPause(t){this.onState(c.PAUSED,t)}set onPlay(t){this.onState(c.PLAYING,t)}set onEnded(t){this.onState(c.ENDED,t)}set onTimeUpdate(t){const monitorVideo=(e,i)=>youtube_player_awaiter(this,void 0,void 0,(function*(){if((yield this.player.getPlayerState())!==c.PLAYING)return;const e=yield this.player.getCurrentTime(),i=yield this.player.getDuration();t(i,e),setTimeout(monitorVideo,250)}));this.onState(c.PLAYING,monitorVideo)}}var __decorate=function(t,e,i,o){var n,s=arguments.length,r=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(r=(s<3?n(r):s>3?n(e,i,r):n(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},video_element_awaiter=function(t,e,i,o){return new(i||(i=Promise))((function(n,s){function fulfilled(t){try{step(o.next(t))}catch(t){s(t)}}function rejected(t){try{step(o.throw(t))}catch(t){s(t)}}function step(t){t.done?n(t.value):function adopt(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,e||[])).next())}))};let d=class VideoElement extends s.A{constructor(t,e,i,o){super(i,o,t),this.i18n=t,this.interaction=e,this.voiceControl=i,this.utils=o}onIntersect(t){this.player.loaded||t.find((t=>t.isIntersecting))&&this.load()}load(){return video_element_awaiter(this,void 0,void 0,(function*(){this.player.loaded||(yield this.player.load(),this.player.onTimeUpdate=(t,e)=>this.interaction.emit(new n.SB({id:this.id,type:this.type,description:this.description,duration:t,time:e})),this.player.onLoad=()=>this.interaction.emit(new n.HB({id:this.id,type:this.type,description:this.description})),this.player.onEnded=(t,e)=>this.interaction.emit(new n.Hc({id:this.id,type:this.type,description:this.description,duration:t,time:e})),this.player.onPause=(t,e)=>this.interaction.emit(new n.Ym({id:this.id,type:this.type,description:this.description,duration:t,time:e})),this.player.onPlay=(t,e)=>this.interaction.emit(new n.uX({id:this.id,type:this.type,description:this.description,duration:t,time:e})))}))}init(){const t=Object.create(null,{init:{get:()=>super.init}});return video_element_awaiter(this,void 0,void 0,(function*(){yield t.init.call(this);const e=this.widget.querySelector(".element-video"),i="1"==e.dataset.defaultCaptions;if(e.classList.contains("vimeo")?this.player=new VimeoPlayer(this.i18n,this.id,e.dataset.videoId,i):e.classList.contains("youtube")?this.player=new YTPlayer(this.id,e.dataset.videoId,i):console.error("Unknown video player"),"IntersectionObserver"in window){new IntersectionObserver((t=>this.onIntersect(t)),{root:null,rootMargin:"200px"}).observe(this.widget)}else this.load();document.addEventListener("keyup",(t=>{"Escape"===t.key&&this.widget.querySelector(".element-video").classList.contains("maximized")&&this.voiceControlMinimize()})),document.addEventListener("click",(t=>{t.target!==document.querySelector(".btn-video-minimize")||this.widget.querySelector(".element-video").classList.contains("maximized")||this.voiceControlMinimize()}))}))}voiceControlPlay(){this.player.play()}voiceControlPause(){this.player.pause()}voiceControlStop(){this.player.stop()}voiceControlRepeat(){this.voiceControlMessageElem.innerHTML+=this.utils.alert("alert-info",this.i18n.value("tta-info-video"))}voiceControlMinimize(){this.widget.querySelector(".element-video").classList.remove("maximized"),this.interaction.emit(new n.s9({id:this.id,type:this.type,description:this.description}))}voiceControlMaximize(){this.widget.querySelector(".element-video").classList.add("maximized"),this.interaction.emit(new n.gY({id:this.id,type:this.type,description:this.description}))}};d=__decorate([(0,o.x)({selector:".widget-video"}),__metadata("design:paramtypes",[r.A,l.A,h.A,a.A])],d);const u=d}}]);