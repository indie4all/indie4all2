"use strict";(self.webpackChunkCDN=self.webpackChunkCDN||[]).push([[3172,7523],{19412:(t,e,i)=>{i.d(e,{A:()=>Element});var o=i(16126),s=i(3605),__awaiter=function(t,e,i,o){return new(i||(i=Promise))((function(s,n){function fulfilled(t){try{step(o.next(t))}catch(t){n(t)}}function rejected(t){try{step(o.throw(t))}catch(t){n(t)}}function step(t){t.done?s(t.value):function adopt(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,e||[])).next())}))};class Element{constructor(t,e,i){this.voiceControl=t,this.utils=e,this.i18n=i,this._activityNumber=0}init(){return __awaiter(this,void 0,void 0,(function*(){if(!this._widget)throw new Error("ElementHTML widget has not been set.");this.voiceControlMessageElem=this.widget.querySelector(".tta-message"),this.voiceControlButton=document.querySelector(`#speech-to-action-${this.id}`),this.voiceControlButton&&(this.voiceControlButton.addEventListener("click",(()=>{if(this.voiceControl.currentTarget!==this.id){for(;this.voiceControl.numTargets>1;)this.voiceControl.popTarget();return this._parent&&this.voiceControl.addTarget(this._parent.id),void this.voiceControl.addTarget(this.id)}this.voiceControl.popTarget(),this.voiceControlButton&&this.toggleVoiceControlButton(!1)})),this.voiceControl.voiceControlTargetChanged.subscribe((t=>{this.id===t.old&&this.toggleVoiceControlButton(!1),this.id===t.new&&this.toggleVoiceControlButton(!0)})),this.voiceControl.voiceControlActions.pipe((0,o.p)((t=>t.target===this.id))).subscribe((t=>{t instanceof s.m6?this.voiceControlStart():t instanceof s.$q?this.voiceControlFinish():t instanceof s.DZ?this.voiceControlNext():t instanceof s.vZ?this.voiceControlPrevious():t instanceof s.Fd?this.voiceControlGoto(t.position):t instanceof s.V3?this.voiceControlBack():t instanceof s.gZ?this.voiceControlSelect():t instanceof s.CG?this.voiceControlClose():t instanceof s.sT?this.voiceControlCheck():t instanceof s.XR?this.voiceControlCurrent():t instanceof s.B$?this.voiceControlDelete():t instanceof s._R?this.voiceControlMaximize():t instanceof s.EZ?this.voiceControlMinimize():t instanceof s.$V?this.voiceControlMove(t.position):t instanceof s.ow?this.voiceControlPause():t instanceof s.OR?this.voiceControlPlay():t instanceof s.pr?this.voiceControlRepeat():t instanceof s.lR?this.voiceControlReset():t instanceof s.m6?this.voiceControlStart():t instanceof s.o3?this.voiceControlStop():t instanceof s.HU?this.voiceControlWrite(t.text):t instanceof s.kw&&this.voiceControlUnknown()})))}))}get description(){return this.widget.dataset.desc||""}get id(){return this.widget.id}get type(){return this.widget.dataset.type||""}get widget(){return this._widget}set widget(t){this._widget=t}get parent(){return this._parent}set parent(t){this._parent=t}set activityNumber(t){this._activityNumber=t,this.voiceControlButton&&(this.voiceControlButton.innerHTML+=`<span class="element-number">${this.i18n.value("tta-activity-number")} ${t}</span>`)}toggleHighlight(t){this.widget.classList.toggle("speech-focused",t)}toggleVoiceControlButton(t){if(this.voiceControlButton){const e=this.voiceControlButton.querySelector("svg");e&&(e.classList.toggle("fa-head-side-cough",t),e.classList.toggle("fa-head-side-cough-slash",!t))}}showVoiceControlButton(){this.voiceControlButton&&(this.voiceControlButton.classList.add("show"),this.toggleVoiceControlButton(!1))}hideVoiceControlButton(){this.voiceControlButton&&this.voiceControlButton.classList.remove("show")}voiceControlStart(){this.toggleVoiceControlButton(!0)}voiceControlFinish(){this.voiceControl.popTarget(),this.toggleVoiceControlButton(!1)}voiceControlClose(){this.voiceControlUnknown()}voiceControlCheck(){this.voiceControlUnknown()}voiceControlCurrent(){this.voiceControlUnknown()}voiceControlDelete(){this.voiceControlUnknown()}voiceControlMaximize(){this.voiceControlUnknown()}voiceControlMinimize(){this.voiceControlUnknown()}voiceControlMove(t){this.voiceControlUnknown()}voiceControlPause(){this.voiceControlUnknown()}voiceControlPlay(){this.voiceControlUnknown()}voiceControlRepeat(){this.voiceControlUnknown()}voiceControlReset(){this.voiceControlUnknown()}voiceControlStop(){this.voiceControlUnknown()}voiceControlWrite(t){this.voiceControlUnknown()}voiceControlNext(){this.voiceControlUnknown()}voiceControlPrevious(){this.voiceControlUnknown()}voiceControlGoto(t){this.voiceControlUnknown()}voiceControlBack(){this.voiceControlUnknown()}voiceControlSelect(){this.voiceControlUnknown()}voiceControlUnknown(){this.voiceControlMessageElem.innerHTML+=this.utils.alert("alert-danger",this.i18n.value("tta-error-message"))}}},27171:(t,e,i)=>{i.d(e,{A:()=>RouletteElement});var o=i(46894),s=i(19412),__awaiter=function(t,e,i,o){return new(i||(i=Promise))((function(s,n){function fulfilled(t){try{step(o.next(t))}catch(t){n(t)}}function rejected(t){try{step(o.throw(t))}catch(t){n(t)}}function step(t){t.done?s(t.value):function adopt(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,e||[])).next())}))};class RouletteElement extends((0,o.A)(s.A)){constructor(t,e,i){super(t,e,i),this.voiceControl=t,this.utils=e,this.i18n=i}get questions(){return this._questions}init(){const t=Object.create(null,{init:{get:()=>super.init}});return __awaiter(this,void 0,void 0,(function*(){yield t.init.call(this),this.spinner=this.widget.querySelector(".roulette-spin"),this.elementsToHideWhenQuestion=Array.from(this.widget.querySelectorAll(".container-roulette,.roulette-lifes,.roulette-heading")),this.categories=Array.from(this.widget.querySelectorAll(".roulette-category")),this.lifesContainer=this.widget.querySelector(".roulette-lifes"),this.circle=this.widget.querySelector(".roulette-circle"),this.lifes=Array.from(this.widget.querySelectorAll(".fa-heart")),this.widget.querySelector(".roulette-spinner-"+this.categories.length).classList.remove("d-none")}))}check(){}voiceControlRepeat(){this.voiceControlMessageElem.innerHTML+=this.utils.alert("alert-info",this.i18n.value("tta-info-containertest"))}voiceControlReset(){this.reset()}voiceControlSelect(){if(this.widget.querySelector(".roulette-spin").click(),this.currentQuestion){const t=this.children.find((t=>this.currentQuestion.contains(t.widget)));this.voiceControl.addTarget(t.id)}}}},43172:(t,e,i)=>{i.r(e),i.d(e,{default:()=>l});var o=i(65360),s=i(75015),n=i(97523),r=i(35999),c=i(27171),__decorate=function(t,e,i,o){var s,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(s=t[c])&&(r=(n<3?s(r):n>3?s(e,i,r):s(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},__awaiter=function(t,e,i,o){return new(i||(i=Promise))((function(s,n){function fulfilled(t){try{step(o.next(t))}catch(t){n(t)}}function rejected(t){try{step(o.throw(t))}catch(t){n(t)}}function step(t){t.done?s(t.value):function adopt(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,e||[])).next())}))};let h=class GamificationTeacherService extends n.default{constructor(t){super(t),this.interaction=t,this._user={id:"teacher",name:"teacher",startTime:Date.now()}}finishActivity(){this.updateScoresIncludingPenalization(),sessionStorage.setItem("indie-asignedstudentlist",JSON.stringify(this.finalScores)),sessionStorage.removeItem(this.code+"-step"),sessionStorage.removeItem(this.code+"-scores"),sessionStorage.removeItem(this.code+"-students"),sessionStorage.removeItem(this.code+"-user"),this.socket.emit("game-finished",{student_list:this.finalScores,room:this.code})}nextActivity(){this.updateScoresIncludingPenalization(),sessionStorage.setItem(this.code+"-step",this.step.toString()),sessionStorage.setItem(this.code+"-scores",JSON.stringify(this.scoresHistory)),this.socket.emit("game-step",{student_list:this.finalScores,room:this.code,step:this.step+1}),this.step=this.step+1,this.scoresHistory[this.step]=[],this.students.forEach((t=>t.startTime=Date.now()))}updateScoresIncludingPenalization(){const t=this.scoresHistory[this.step];if(!t.length)return;const e=t.filter((t=>t.correct));if(!e.length)return;const i=e.length?Math.min(...e.map((t=>t.time))):Math.min(...t.map((t=>t.time))),o=Math.max(...t.map((t=>t.time)));t.forEach((t=>{const e=i===o?0:.2*t.points*(Math.max(0,t.time-i)/(o-i));t.points=t.points-e}))}init(){const t=Object.create(null,{init:{get:()=>super.init}});return __awaiter(this,void 0,void 0,(function*(){yield t.init.call(this),this.scoresHistory[this.step]=[],this.socket.on("update-user-list",(t=>{if(this.step!==t.step)return;if(this.scoresHistory[this.step].find((e=>e.id===t.id)))return;const e=this.students.find((e=>e.id===t.id)),i={id:t.id,name:t.username,time:t.time-e.startTime,points:t.score,correct:t.res},o=this.scoresHistory;o[this.step]=o[this.step]||[],o[this.step].push(i),this.scoresHistory=o})),this.socket.on("hello",((t,e)=>{const i=this.students.find((e=>e.id===t));let o;i?o=i:(o={id:t,name:e,startTime:Date.now()},this.students=this.students.concat(o));const s={id:o.id,step:this.step};this.activity instanceof c.A&&(s.questions=this.activity.questions),this.socket.emit("ack",s)})),this.interaction.getInteractions(s.yz).subscribe((t=>{this.socket.emit("stop-activity",{room:this.code})}))}))}emit(t){switch(t){case"next":this.nextActivity();break;case"finish":this.finishActivity()}}};h=__decorate([(0,o.k)({global:!0}),__metadata("design:paramtypes",[r.A])],h);const l=h},97523:(t,e,i)=>{i.r(e),i.d(e,{default:()=>l});var o=i(65360),s=i(96107),n=i(94442),r=i(37115),c=i(35999),__decorate=function(t,e,i,o){var s,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(s=t[c])&&(r=(n<3?s(r):n>3?s(e,i,r):s(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},__awaiter=function(t,e,i,o){return new(i||(i=Promise))((function(s,n){function fulfilled(t){try{step(o.next(t))}catch(t){n(t)}}function rejected(t){try{step(o.throw(t))}catch(t){n(t)}}function step(t){t.done?s(t.value):function adopt(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((o=o.apply(t,e||[])).next())}))};let h=class GamificationService{constructor(t){this.interaction=t,this._code="test",this._scoresHistory=[],this.gamificationSubject=new s.B,this.gamificationEvents$=this.gamificationSubject.asObservable(),this.studentsChangedSubject=new n.m(1),this.studentsChanged$=this.studentsChangedSubject.asObservable()}get gamificationEvents(){return this.gamificationEvents$}get finalScores(){const t=this.scoresHistory[this.step],e=this.students.map((e=>{const i=t.find((t=>t.id===e.id)),o=this.scoresHistory.map((t=>{var i;return(null===(i=t.find((t=>t.id===e.id)))||void 0===i?void 0:i.points)||0})).reduce(((t,e)=>t+e),0);return{id:e.id,name:e.name,time:(null==i?void 0:i.time)||0,points:(null==i?void 0:i.points)||0,correct:(null==i?void 0:i.correct)||!1,total:o}}));return e.sort(((t,e)=>e.total-t.total)),e}get scoresHistory(){return this._scoresHistory||(this._scoresHistory=JSON.parse(sessionStorage.getItem(this._code+"-scores"))||[]),this._scoresHistory}set scoresHistory(t){this._scoresHistory=t,sessionStorage.setItem(this._code+"-scores",JSON.stringify(t))}get activity(){return this._activity}set activity(t){this._activity=t}get code(){return this._code}set code(t){this._code=t}get user(){return this._user||(this._user=JSON.parse(sessionStorage.getItem(this._code+"-user"))),this._user}set user(t){this._user=t,sessionStorage.setItem(this._code+"-user",JSON.stringify(t))}get socket(){return this._socket}set socket(t){this._socket=t}get step(){return"number"!=typeof this._step&&(this._step=JSON.parse(sessionStorage.getItem(this._code+"-step"))||0),this._step}set step(t){this._step=t,sessionStorage.setItem(this._code+"-step",JSON.stringify(t))}get students(){return this._students||(this._students=JSON.parse(sessionStorage.getItem(this._code+"-students"))||[],this.studentsChangedSubject.next(this._students)),this._students.forEach((t=>{var e;return t.answered=void 0!==(null===(e=this.scoresHistory[this.step])||void 0===e?void 0:e.find((e=>e.id===t.id))),t})),this._students}set students(t){this._students=t,sessionStorage.setItem(this._code+"-students",JSON.stringify(t)),this.studentsChangedSubject.next(t)}get studentsChanged(){return this.studentsChanged$}join(){this._socket.emit("join-room",this._code,this.user.id,{username:this.user.name})}init(){return __awaiter(this,void 0,void 0,(function*(){this._socket=(0,r.io)("http://cpcdpruebas.upct.es:3000",{forceNew:!0})}))}};h=__decorate([(0,o.k)({global:!0}),__metadata("design:paramtypes",[c.A])],h);const l=h}}]);