"use strict";(self.webpackChunkCDN=self.webpackChunkCDN||[]).push([[79744],{77349:(e,t,i)=>{i.r(t),i.d(t,{default:()=>m});var r=i(16492),s=i(75015),o=i(7979),c=i(35999),n=i(11867),a=i(70583),l=i(61709),h=i(20427),p=i.n(h),d=i(48483),f=i(50667),g=i(83034),__decorate=function(e,t,i,r){var s,o=arguments.length,c=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,i,r);else for(var n=e.length-1;n>=0;n--)(s=e[n])&&(c=(o<3?s(c):o>3?s(t,i,c):s(t,i))||c);return o>3&&c&&Object.defineProperty(t,i,c),c},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let u=class PuzzleOpenElement extends n.A{constructor(e,t,i,r,s,o,c){super(e,t,s,i,c),this.utils=e,this.bootstrap=t,this.i18n=i,this.interaction=r,this.voiceControl=s,this.contentService=o,this.alert=c}clipRect(e,t,i,r){const s=e.getImageData(t.x,t.y,t.w,t.h),o=document.createElement("canvas");o.width=t.w,o.height=t.h;return o.getContext("2d").putImageData(s,0,0),e.fillRect(t.x,t.y,t.w,t.h),p()({alt:t.altImg,id:i,pos:r,url:o.toDataURL()})}onImageLoaded(){const e=document.createElement("canvas");e.width=this.tmpImg.width,e.height=this.tmpImg.height;const t=e.getContext("2d",{willReadFrequently:!0});t.fillStyle="white",t.fillRect(0,0,e.width,e.height),t.drawImage(this.tmpImg,0,0),t.fillStyle="#fff";const i=this.rects.map(((e,i)=>this.clipRect(t,e,this.id,i)));this.utils.shuffle(this.rects),this.widget.querySelectorAll(".pieces-list .piece-placeholder .dropdown").forEach(((e,t)=>e.innerHTML+=i[t])),this.widget.querySelectorAll("[data-bs-toggle]").forEach((e=>this.dropDownModule.getOrCreateInstance(e))),this.layer.setAttribute("viewBox",`0 0 ${this.tmpImg.width} ${this.tmpImg.height}`),this.background.src=e.toDataURL("image/jpeg"),this.resizeSVG(),console.debug("[Puzzle] Initialized")}feedback(e){const t=Array.from(this.widget.querySelectorAll(".piece-wrapper .piece")),i=Array.from(this.widget.querySelectorAll(".piece-placeholder")).map((e=>e)).filter((e=>""===e.innerHTML));t.filter((e=>e.dataset.pos!==e.closest(".piece-wrapper").dataset.pos)).forEach(((e,t)=>i[t].append(e.closest(".dropdown")))),this.widget.querySelector(".text-result").innerHTML=this.i18n.value("common.num-correct",{num:e})}async init(){await super.init(),this.rects=await this.contentService.get(this.id),this.tmpImg=new Image,this.tmpImg.onload=()=>this.onImageLoaded(),this.tmpImg.src=this.background.dataset.src,this.tmpImg.crossOrigin="anonymous"}check(){const e=Array.from(this.widget.querySelectorAll(".piece-wrapper .piece")),t=e.filter((e=>e.dataset.pos!==e.closest(".piece-wrapper").dataset.pos)),i=e.length-t.length,r=i/this.rects.length;this.interaction.emit(new s.sV({id:this.id,type:this.type,description:this.description,score:r})),1===r&&this.interaction.emit(new s.yz({id:this.id,type:this.type,description:this.description})),this.feedback(i)}reset(){this.interaction.emit(new s.nz({id:this.id,type:this.type,description:this.description})),this.widget.querySelectorAll(".piece-wrapper, .piece-placeholder").forEach((e=>e.setAttribute("aria-dropeffect",""))),this.grabbed&&(this.grabbed.setAttribute("aria-grabbed","false"),this.grabbed=null);const e=Array.from(this.widget.querySelectorAll(".piece-wrapper .piece"));Array.from(this.widget.querySelectorAll(".piece-placeholder")).filter((e=>""===e.innerHTML)).forEach(((t,i)=>t.append(e[i].closest(".dropdown")))),this.widget.querySelector(".text-result").innerHTML=""}};u=__decorate([(0,r.x)({selector:".widget-puzzle"}),__metadata("design:paramtypes",[a.A,o.A,g.A,c.A,l.A,d.A,f.A])],u);const m=u},48483:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(65360),s=i(70583),__decorate=function(e,t,i,r){var s,o=arguments.length,c=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,i,r);else for(var n=e.length-1;n>=0;n--)(s=e[n])&&(c=(o<3?s(c):o>3?s(t,i,c):s(t,i))||c);return o>3&&c&&Object.defineProperty(t,i,c),c},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let o=class ContentService{constructor(e){this.utils=e,this.loading=!1}async get(e){for(;this.loading;)await this.utils.sleep(100);if(this.content||(this.loading=!0,this.content=await fetch("./content.json").then((e=>e.json())),this.loading=!1),!this.content[e])throw new Error(`Widget ${e} not found`);return JSON.parse(this.utils.b64DecodeUnicode(this.content[e]))}};o=__decorate([(0,r.k)({global:!0}),__metadata("design:paramtypes",[s.A])],o);const c=o}}]);