"use strict";(self.webpackChunkCDN=self.webpackChunkCDN||[]).push([[38610,7885,13027],{7885:(e,t,r)=>{r.d(t,{default:()=>s});var n=r(65360),i=r(13027),o=r(70583),__decorate=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let a=class AuthService{constructor(e,t){this.cipherService=e,this.utils=t}decodeToken(e){let t=e,r=this.utils.base64UrlDecode(null==t?void 0:t.split(".")[1]).toString();return JSON.parse(r)}getTokenExpirationTimeMs(e){if(this.currentUser&&this.currentUser[e]){let t=this.currentUser[e],r=this.utils.base64UrlDecode(null==t?void 0:t.split(".")[1]).toString();return 1e3*JSON.parse(r).exp}return null}isAccessTokenExpired(){return this.isTokenExpired("access_token")}isRefreshTokenExpired(){return this.isTokenExpired("refresh_token")}isTokenExpired(e){const t=this.getTokenExpirationTimeMs(e);if(Number.isFinite(t)){return Math.floor((new Date).getTime())>=t}return!1}get currentUser(){return this._currentUser}set currentUser(e){this._currentUser=e}};a=__decorate([(0,n.k)({global:!0}),__metadata("design:paramtypes",[i.default,o.A])],a);const s=a},13027:(e,t,r)=>{r.d(t,{default:()=>a});var n=r(65360),i=r(70583),__decorate=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let o=class CipherService{constructor(e){this.utils=e,this.encoder=new TextEncoder,this.key=this.encoder.encode("2yWfEgocFom9jbWN"),this.iv=this.encoder.encode("AODVNUASDNVVAOVF")}async encrypt(e){const t=await window.crypto.subtle.importKey("raw",this.key,"AES-CBC",!1,["encrypt"]),r=this.utils.str2ab(e),n=await window.crypto.subtle.encrypt({name:"AES-CBC",iv:this.iv},t,r);return btoa(this.utils.ab2str(n))}async decrypt(e){const t=await window.crypto.subtle.importKey("raw",this.key,"AES-CBC",!1,["decrypt"]),r=this.utils.str2ab(atob(e)),n=await window.crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv},t,r);return this.utils.ab2str(n)}};o=__decorate([(0,n.k)({global:!0}),__metadata("design:paramtypes",[i.A])],o);const a=o},38610:(e,t,r)=>{r.d(t,{A:()=>g});var n=r(65360),i=r(94442),o=r(31635),isArrayLike=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e},a=r(61209);function isPromise(e){return(0,a.T)(null==e?void 0:e.then)}var s=r(52718),c=r(55604);function isInteropObservable(e){return(0,a.T)(e[c.s])}function isAsyncIterable(e){return Symbol.asyncIterator&&(0,a.T)(null==e?void 0:e[Symbol.asyncIterator])}function createInvalidObservableTypeError(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var u=function getSymbolIterator(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function isIterable(e){return(0,a.T)(null==e?void 0:e[u])}function readableStreamLikeToAsyncGenerator(e){return(0,o.AQ)(this,arguments,(function readableStreamLikeToAsyncGenerator_1(){var t,r,n;return(0,o.YH)(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,(0,o.N3)(t.read())];case 3:return r=i.sent(),n=r.value,r.done?[4,(0,o.N3)(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,(0,o.N3)(n)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function isReadableStreamLike(e){return(0,a.T)(null==e?void 0:e.getReader)}var l=r(22564);function innerFrom(e){if(e instanceof s.c)return e;if(null!=e){if(isInteropObservable(e))return function fromInteropObservable(e){return new s.c((function(t){var r=e[c.s]();if((0,a.T)(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}))}(e);if(isArrayLike(e))return function fromArrayLike(e){return new s.c((function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()}))}(e);if(isPromise(e))return function fromPromise(e){return new s.c((function(t){e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,l.m)}))}(e);if(isAsyncIterable(e))return fromAsyncIterable(e);if(isIterable(e))return function fromIterable(e){return new s.c((function(t){var r,n;try{for(var i=(0,o.Ju)(e),a=i.next();!a.done;a=i.next()){var s=a.value;if(t.next(s),t.closed)return}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}t.complete()}))}(e);if(isReadableStreamLike(e))return function fromReadableStreamLike(e){return fromAsyncIterable(readableStreamLikeToAsyncGenerator(e))}(e)}throw createInvalidObservableTypeError(e)}function fromAsyncIterable(e){return new s.c((function(t){(function process(e,t){var r,n,i,a;return(0,o.sH)(this,void 0,void 0,(function(){var s,c;return(0,o.YH)(this,(function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),r=(0,o.xN)(e),u.label=1;case 1:return[4,r.next()];case 2:if((n=u.sent()).done)return[3,4];if(s=n.value,t.next(s),t.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return c=u.sent(),i={error:c},[3,11];case 6:return u.trys.push([6,,9,10]),n&&!n.done&&(a=r.return)?[4,a.call(r)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function executeSchedule(e,t,r,n,i){void 0===n&&(n=0),void 0===i&&(i=!1);var o=t.schedule((function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()}),n);if(e.add(o),!i)return o}var d=r(92908),f=r(64878);function observeOn(e,t){return void 0===t&&(t=0),(0,d.N)((function(r,n){r.subscribe((0,f._)(n,(function(r){return executeSchedule(n,e,(function(){return n.next(r)}),t)}),(function(){return executeSchedule(n,e,(function(){return n.complete()}),t)}),(function(r){return executeSchedule(n,e,(function(){return n.error(r)}),t)})))}))}function subscribeOn(e,t){return void 0===t&&(t=0),(0,d.N)((function(r,n){n.add(e.schedule((function(){return r.subscribe(n)}),t))}))}function scheduleAsyncIterable(e,t){if(!e)throw new Error("Iterable cannot be null");return new s.c((function(r){executeSchedule(r,t,(function(){var n=e[Symbol.asyncIterator]();executeSchedule(r,t,(function(){n.next().then((function(e){e.done?r.complete():r.next(e.value)}))}),0,!0)}))}))}function scheduled(e,t){if(null!=e){if(isInteropObservable(e))return function scheduleObservable(e,t){return innerFrom(e).pipe(subscribeOn(t),observeOn(t))}(e,t);if(isArrayLike(e))return function scheduleArray(e,t){return new s.c((function(r){var n=0;return t.schedule((function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())}))}))}(e,t);if(isPromise(e))return function schedulePromise(e,t){return innerFrom(e).pipe(subscribeOn(t),observeOn(t))}(e,t);if(isAsyncIterable(e))return scheduleAsyncIterable(e,t);if(isIterable(e))return function scheduleIterable(e,t){return new s.c((function(r){var n;return executeSchedule(r,t,(function(){n=e[u](),executeSchedule(r,t,(function(){var e,t,i;try{t=(e=n.next()).value,i=e.done}catch(e){return void r.error(e)}i?r.complete():r.next(t)}),0,!0)})),function(){return(0,a.T)(null==n?void 0:n.return)&&n.return()}}))}(e,t);if(isReadableStreamLike(e))return function scheduleReadableStreamLike(e,t){return scheduleAsyncIterable(readableStreamLikeToAsyncGenerator(e),t)}(e,t)}throw createInvalidObservableTypeError(e)}function from(e,t){return t?scheduled(e,t):innerFrom(e)}var h=r(89791),b=r(50667),p=r(44295),__decorate=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let y=class I18nEvaluationService extends p.A{constructor(){super(),this.LANGUAGES={ar:()=>r.e(43288).then(r.t.bind(r,43288,19)),bg:()=>r.e(10636).then(r.t.bind(r,10636,19)),ca:()=>r.e(17981).then(r.t.bind(r,17981,19)),cs:()=>r.e(40207).then(r.t.bind(r,40207,19)),da:()=>r.e(21692).then(r.t.bind(r,21692,19)),de:()=>r.e(62752).then(r.t.bind(r,62752,19)),el:()=>r.e(85602).then(r.t.bind(r,85602,19)),en:()=>r.e(51304).then(r.t.bind(r,51304,19)),es:()=>r.e(57149).then(r.t.bind(r,57149,19)),et:()=>r.e(53434).then(r.t.bind(r,53434,19)),eu:()=>r.e(76099).then(r.t.bind(r,76099,19)),fi:()=>r.e(39302).then(r.t.bind(r,39302,19)),fr:()=>r.e(99717).then(r.t.bind(r,22098,19)),ga:()=>r.e(19201).then(r.t.bind(r,19201,19)),gl:()=>r.e(25540).then(r.t.bind(r,25540,19)),hr:()=>r.e(87731).then(r.t.bind(r,87731,19)),hu:()=>r.e(71468).then(r.t.bind(r,71468,19)),it:()=>r.e(7270).then(r.t.bind(r,7270,19)),ja:()=>r.e(99506).then(r.t.bind(r,99506,19)),lv:()=>r.e(3451).then(r.t.bind(r,3451,19)),lt:()=>r.e(16297).then(r.t.bind(r,16297,19)),mt:()=>r.e(72354).then(r.t.bind(r,72354,19)),nb:()=>r.e(4221).then(r.t.bind(r,4221,19)),nl:()=>r.e(14715).then(r.t.bind(r,14715,19)),pl:()=>r.e(74701).then(r.t.bind(r,74701,19)),pt:()=>r.e(55086).then(r.t.bind(r,55086,19)),ro:()=>r.e(20308).then(r.t.bind(r,20308,19)),sk:()=>r.e(10279).then(r.t.bind(r,10279,19)),sl:()=>r.e(60168).then(r.t.bind(r,60168,19)),sv:()=>r.e(826).then(r.t.bind(r,826,19)),uk:()=>r.e(79477).then(r.t.bind(r,79477,19)),yue:()=>r.e(32).then(r.t.bind(r,32,19))}}};y=__decorate([(0,n.k)({global:!0}),__metadata("design:paramtypes",[])],y);const v=y;var m=r(7885),evaluation_service_decorate=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},evaluation_service_metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let w=class EvaluationService{constructor(e,t,r,n){this.modal=e,this.alert=t,this.i18nEvaluation=r,this.auth=n,this.initialized=!1,this.baseUrl="https://indiegateway.upct.es/api/",this.attemptsSubject=new i.m(100),this.laboratorySubject=new i.m(1)}get attempts(){return this.attemptsSubject.asObservable()}get laboratory(){return this.laboratorySubject.asObservable()}getMessageFromErrorCode(e,t={}){return(null==t?void 0:t.startDate)&&(t.startDate=new Date(t.startDate).toLocaleString()),(null==t?void 0:t.endDate)&&(t.endDate=new Date(t.endDate).toLocaleString()),this.i18nEvaluation.value("errors."+e,{...t,interpolation:{escapeValue:!1}})}getMessageFromHttpCode(e){return this.i18nEvaluation.value("errors.http."+e)}async getErrorMessage(e){try{const t=await e.json();return t.code?this.getMessageFromErrorCode(t.code,t.parameters):this.getMessageFromHttpCode(e.status)}catch(t){return this.getMessageFromHttpCode(e.status)}}async fetch(e,t={},r="modal"){var n;const i="LTI"===this.auth.mode?{headers:{...null==t?void 0:t.headers,Authorization:"Bearer "+(null===(n=this.auth.currentUser)||void 0===n?void 0:n.access_token)}}:{credentials:"include"},o={...t,...i},a=await fetch(e,o);if(!a.ok){const e=await this.getErrorMessage(a);throw"modal"===r?this.modal.error(e):this.alert.danger(e),new Error(a.statusText)}return a}async login(){return await(await this.fetch(this.baseUrl+"login")).json()}async init(){await this.i18nEvaluation.init(),"LTI"===this.auth.mode?this.baseUrl="https://indiegateway.upct.es/api/evaluation/students/":this.baseUrl=`https://indiegateway.upct.es/api/evaluation/sir/session/${new URLSearchParams(window.location.search).get("evaluationid")}/`;const e=await this.login();this.initialized=!0,e.attempts&&e.attempts.forEach((e=>this.attemptsSubject.next(e))),e.laboratory&&this.laboratorySubject.next(e.laboratory)}get(e){if(!this.initialized)throw new Error("Evaluation service not initialized");return from(this.fetch(this.baseUrl+`activities/${e}`).then((e=>e.json())))}check(e,t){if(!this.initialized)throw new Error("Evaluation service not initialized");return from(this.fetch(this.baseUrl+`activities/${e}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)},"alert"))}};w=evaluation_service_decorate([(0,n.k)({global:!0}),evaluation_service_metadata("design:paramtypes",[h.A,b.A,v,m.default])],w);const g=w},89791:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(65360),i=r(7979),o=r(83034),__decorate=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let a=class ModalService{constructor(e,t){this.bootstrap=e,this.i18n=t}async show(e){const t=await this.bootstrap.loadModalModule(),r=document.getElementById("sharedModal"),n=t.getOrCreateInstance(r);n.hide();const onHidden=()=>{r.innerHTML="",r.removeEventListener("hidden.bs.modal",onHidden)};r.addEventListener("hidden.bs.modal",onHidden),r.innerHTML=e,n.show()}async error(e){const{default:t}=await r.e(25628).then(r.t.bind(r,25628,23)),n=t({message:e});await this.show(n)}async loading(e){const{default:t}=await r.e(69322).then(r.t.bind(r,69322,23)),n=t({message:e});await this.show(n)}async hide(){const e=await this.bootstrap.loadModalModule(),t=document.getElementById("sharedModal");e.getOrCreateInstance(t).hide()}};a=__decorate([(0,n.k)({global:!0}),__metadata("design:paramtypes",[i.A,o.A])],a);const s=a}}]);