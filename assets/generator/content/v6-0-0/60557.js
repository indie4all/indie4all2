"use strict";(self.webpackChunkCDN=self.webpackChunkCDN||[]).push([[60557,97523],{97523:(t,e,s)=>{s.d(e,{default:()=>u});var i=s(65360),n=s(27291),o=s(94442),r=s(37115),c=s(35999),__decorate=function(t,e,s,i){var n,o=arguments.length,r=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(r=(o<3?n(r):o>3?n(e,s,r):n(e,s))||r);return o>3&&r&&Object.defineProperty(e,s,r),r},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let a=class GamificationService{constructor(t){this.interaction=t,this._code="test",this._scoresHistory=[],this.gamificationSubject=new n.B,this.gamificationEvents$=this.gamificationSubject.asObservable(),this.studentsChangedSubject=new o.m(1),this.studentsChanged$=this.studentsChangedSubject.asObservable()}get gamificationEvents(){return this.gamificationEvents$}get finalScores(){const t=this.scoresHistory[this.step],e=this.students.map((e=>{const s=t.find((t=>t.id===e.id)),i=this.scoresHistory.map((t=>{var s;return(null===(s=t.find((t=>t.id===e.id)))||void 0===s?void 0:s.points)||0})).reduce(((t,e)=>t+e),0);return{id:e.id,name:e.name,time:(null==s?void 0:s.time)||0,points:(null==s?void 0:s.points)||0,correct:(null==s?void 0:s.correct)||!1,total:i}}));return e.sort(((t,e)=>e.total-t.total)),e}get scoresHistory(){return this._scoresHistory||(this._scoresHistory=JSON.parse(sessionStorage.getItem(this._code+"-scores"))||[]),this._scoresHistory}set scoresHistory(t){this._scoresHistory=t,sessionStorage.setItem(this._code+"-scores",JSON.stringify(t))}get activity(){return this._activity}set activity(t){this._activity=t}get code(){return this._code}set code(t){this._code=t}get user(){return this._user||(this._user=JSON.parse(sessionStorage.getItem(this._code+"-user"))),this._user}set user(t){this._user=t,sessionStorage.setItem(this._code+"-user",JSON.stringify(t))}get socket(){return this._socket}set socket(t){this._socket=t}get step(){return"number"!=typeof this._step&&(this._step=JSON.parse(sessionStorage.getItem(this._code+"-step"))||0),this._step}set step(t){this._step=t,sessionStorage.setItem(this._code+"-step",JSON.stringify(t))}get students(){return this._students||(this._students=JSON.parse(sessionStorage.getItem(this._code+"-students"))||[],this.studentsChangedSubject.next(this._students)),this._students.forEach((t=>{var e;return t.answered=void 0!==(null===(e=this.scoresHistory[this.step])||void 0===e?void 0:e.find((e=>e.id===t.id))),t})),this._students}set students(t){this._students=t,sessionStorage.setItem(this._code+"-students",JSON.stringify(t)),this.studentsChangedSubject.next(t)}get studentsChanged(){return this.studentsChanged$}join(){this._socket.emit("join-room",this._code,this.user.id,{username:this.user.name})}async init(){this._socket="MISSING_ENV_VAR".GAMIFICATION_SERVER?(0,r.io)("MISSING_ENV_VAR".GAMIFICATION_SERVER,{forceNew:!0}):(0,r.io)({forceNew:!0})}};a=__decorate([(0,i.k)({global:!0}),__metadata("design:paramtypes",[c.A])],a);const u=a},35999:(t,e,s)=>{s.d(e,{A:()=>a});var i=s(65360),n=s(27291),o=s(16126),r=s(81160),__decorate=function(t,e,s,i){var n,o=arguments.length,r=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(r=(o<3?n(r):o>3?n(e,s,r):n(e,s))||r);return o>3&&r&&Object.defineProperty(e,s,r),r},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let c=class InteractionService{constructor(){this.interactionSubject=new n.B,this.interactions$=this.interactionSubject.asObservable()}getInteractions(t){return this.interactions$.pipe((0,o.p)((e=>e instanceof t)),(0,r.T)((t=>t)))}emit(t){console.debug("Interaction sent",t),this.interactionSubject.next(t)}};c=__decorate([(0,i.k)({global:!0}),__metadata("design:paramtypes",[])],c);const a=c},60557:(t,e,s)=>{s.d(e,{default:()=>v});var i=s(65360),n=s(3605),o=s(7979),r=s(24971),c=s(40561),a=s(97523),u=s(35999),d=s(37607),h=s(92652),f=s(70583),l=s(61709),g=s(50667),m=s(83034),p=s(75521),__decorate=function(t,e,s,i){var n,o=arguments.length,r=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(r=(o<3?n(r):o>3?n(e,s,r):n(e,s))||r);return o>3&&r&&Object.defineProperty(e,s,r),r},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let y=class GamificationLoginUnit extends p.default{constructor(t,e,s,i,n,o,r,c,a,u,d){super(t,e,s,i,n,o,r,c,d),this.factory=t,this.menu=e,this.voiceControl=s,this.bootstrap=i,this.utils=n,this.i18n=o,this.code=r,this.mathjax=c,this.gamification=a,this.interaction=u,this.alert=d}async init(){const t=window.location.pathname.match(/\d{6}/g),e=t?t[0]:null;if(e&&(this.gamification.code=e.toString()),this.gamification.user)return void window.location.replace("game.html");await this.menu.init(this.id);const s=document.getElementById("select-username-form"),i=document.getElementById("input-username"),o=document.getElementById("btn-username");s.addEventListener("submit",(t=>{this.gamification.user={id:this.utils.generateUuid(),name:i.value||"Unknown"}})),this.voiceControl.voiceControlActions.subscribe((t=>{t instanceof n.m6?setTimeout((()=>i.focus()),100):t instanceof n.HU?i.value=t.text:t instanceof n.B$?i.value="":t instanceof n.gZ?o.click():t instanceof n.pr?this.alert.info(this.i18n.vc.value("info.login")):t instanceof n.$q?(this.voiceControl.clearTargets(),this.voiceControl.stop()):this.alert.danger(this.i18n.vc.value("message.error"))}))}};y=__decorate([(0,i.k)(),__metadata("design:paramtypes",[c.default,h.default,l.A,o.A,f.A,m.A,r.A,d.A,a.default,u.A,g.A])],y);const v=y}}]);