/*! For license information please see 23527.js.LICENSE.txt */
"use strict";(self.webpackChunkCDN=self.webpackChunkCDN||[]).push([[23527,7885,13027],{23527:(e,t,r)=>{r.d(t,{default:()=>u});var i=r(65360),n=r(7885),o=r(18987),s=r(13027),c=r(70583),__decorate=function(e,t,r,i){var n,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(s=(o<3?n(s):o>3?n(t,r,s):n(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let a=class AuthEvaluationService extends n.default{constructor(e,t){super(e,t),this.cipherService=e,this.utils=t,this.USER_KEY="indie_lti",this._mode="LTI"}async decryptUser(e){var t;const r=await this.cipherService.decrypt(e),i=this.decodeToken(r);if("evaluation"!==i.type)throw new Error("Invalid token type");if(i.idunidad!==this.unitId)throw new Error("Invalid unit ID");return{access_token:r,activity:i.actividad,analytics:null!==(t=i.analytics)&&void 0!==t&&t,completeName:i.nombre+" "+i.apellido,course:i.curso,domain:i.dominio,email:i.correo,evaluationId:i.evaluationid,id:i.userid,profile:i.profile,roles:i.authorities,title:i.titulo,username:i.user_name}}async getUserFromSessionStorage(){const e=sessionStorage.getItem(this.USER_KEY);try{return await this.decryptUser(e)}catch(e){sessionStorage.removeItem(this.USER_KEY),console.error("[ERROR] Could not get the user info from session")}}async getUserFromCookie(){const e=o.A.get(this.USER_KEY);try{const t=await this.decryptUser(e);return sessionStorage.setItem(this.USER_KEY,e),o.A.remove(this.USER_KEY,{path:"/",domain:"upct.es"}),t}catch(e){o.A.remove(this.USER_KEY,{path:"/",domain:"upct.es"}),console.error("[ERROR] Could not get the user info from cookie")}}async init(e){this.unitId=e;try{(await fetch("https://indiegateway.upct.es/api/evaluation/sir/info",{credentials:"include"})).ok&&(this._mode="SIR")}catch(e){}"LTI"===this._mode&&(o.A.get(this.USER_KEY)&&(this.currentUser=await this.getUserFromCookie()),!this.currentUser&&sessionStorage.getItem(this.USER_KEY)&&(this.currentUser=await this.getUserFromSessionStorage()))}canStartGamification(){return!1}get mode(){return this._mode}};a=__decorate([(0,i.k)({global:!0}),__metadata("design:paramtypes",[s.default,c.A])],a);const u=a},7885:(e,t,r)=>{r.d(t,{default:()=>c});var i=r(65360),n=r(13027),o=r(70583),__decorate=function(e,t,r,i){var n,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(s=(o<3?n(s):o>3?n(t,r,s):n(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let s=class AuthService{constructor(e,t){this.cipherService=e,this.utils=t}decodeToken(e){let t=e,r=this.utils.base64UrlDecode(null==t?void 0:t.split(".")[1]).toString();return JSON.parse(r)}getTokenExpirationTimeMs(e){if(this.currentUser&&this.currentUser[e]){let t=this.currentUser[e],r=this.utils.base64UrlDecode(null==t?void 0:t.split(".")[1]).toString();return 1e3*JSON.parse(r).exp}return null}isAccessTokenExpired(){return this.isTokenExpired("access_token")}isRefreshTokenExpired(){return this.isTokenExpired("refresh_token")}isTokenExpired(e){const t=this.getTokenExpirationTimeMs(e);if(Number.isFinite(t)){return Math.floor((new Date).getTime())>=t}return!1}get currentUser(){return this._currentUser}set currentUser(e){this._currentUser=e}};s=__decorate([(0,i.k)({global:!0}),__metadata("design:paramtypes",[n.default,o.A])],s);const c=s},13027:(e,t,r)=>{r.d(t,{default:()=>s});var i=r(65360),n=r(70583),__decorate=function(e,t,r,i){var n,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(s=(o<3?n(s):o>3?n(t,r,s):n(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let o=class CipherService{constructor(e){this.utils=e,this.encoder=new TextEncoder,this.key=this.encoder.encode("2yWfEgocFom9jbWN"),this.iv=this.encoder.encode("AODVNUASDNVVAOVF")}async encrypt(e){const t=await window.crypto.subtle.importKey("raw",this.key,"AES-CBC",!1,["encrypt"]),r=this.utils.str2ab(e),i=await window.crypto.subtle.encrypt({name:"AES-CBC",iv:this.iv},t,r);return btoa(this.utils.ab2str(i))}async decrypt(e){const t=await window.crypto.subtle.importKey("raw",this.key,"AES-CBC",!1,["decrypt"]),r=this.utils.str2ab(atob(e)),i=await window.crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv},t,r);return this.utils.ab2str(i)}};o=__decorate([(0,i.k)({global:!0}),__metadata("design:paramtypes",[n.A])],o);const s=o},18987:(e,t,r)=>{function assign(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)e[i]=r[i]}return e}r.d(t,{A:()=>i});var i=function init(e,t){function set(r,i,n){if("undefined"!=typeof document){"number"==typeof(n=assign({},t,n)).expires&&(n.expires=new Date(Date.now()+864e5*n.expires)),n.expires&&(n.expires=n.expires.toUTCString()),r=encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var s in n)n[s]&&(o+="; "+s,!0!==n[s]&&(o+="="+n[s].split(";")[0]));return document.cookie=r+"="+e.write(i,r)+o}}return Object.create({set,get:function get(t){if("undefined"!=typeof document&&(!arguments.length||t)){for(var r=document.cookie?document.cookie.split("; "):[],i={},n=0;n<r.length;n++){var o=r[n].split("="),s=o.slice(1).join("=");try{var c=decodeURIComponent(o[0]);if(i[c]=e.read(s,c),t===c)break}catch(e){}}return t?i[t]:i}},remove:function(e,t){set(e,"",assign({},t,{expires:-1}))},withAttributes:function(e){return init(this.converter,assign({},this.attributes,e))},withConverter:function(e){return init(assign({},this.converter,e),this.attributes)}},{attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(e)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}}]);