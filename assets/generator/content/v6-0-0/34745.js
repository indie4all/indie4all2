"use strict";(self.webpackChunkCDN=self.webpackChunkCDN||[]).push([[34745,25715,7885,13027,93113,26240],{7885:(e,t,i)=>{i.d(t,{default:()=>o});var r=i(65360),n=i(13027),s=i(70583),__decorate=function(e,t,i,r){var n,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(s<3?n(a):s>3?n(t,i,a):n(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let a=class AuthService{constructor(e,t){this.cipherService=e,this.utils=t}decodeToken(e){let t=e,i=this.utils.base64UrlDecode(null==t?void 0:t.split(".")[1]).toString();return JSON.parse(i)}getTokenExpirationTimeMs(e){if(this.currentUser&&this.currentUser[e]){let t=this.currentUser[e],i=this.utils.base64UrlDecode(null==t?void 0:t.split(".")[1]).toString();return 1e3*JSON.parse(i).exp}return null}isAccessTokenExpired(){return this.isTokenExpired("access_token")}isRefreshTokenExpired(){return this.isTokenExpired("refresh_token")}isTokenExpired(e){const t=this.getTokenExpirationTimeMs(e);if(Number.isFinite(t)){return Math.floor((new Date).getTime())>=t}return!1}get currentUser(){return this._currentUser}set currentUser(e){this._currentUser=e}};a=__decorate([(0,r.k)({global:!0}),__metadata("design:paramtypes",[n.default,s.A])],a);const o=a},13027:(e,t,i)=>{i.d(t,{default:()=>a});var r=i(65360),n=i(70583),__decorate=function(e,t,i,r){var n,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(s<3?n(a):s>3?n(t,i,a):n(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let s=class CipherService{constructor(e){this.utils=e,this.encoder=new TextEncoder,this.key=this.encoder.encode("2yWfEgocFom9jbWN"),this.iv=this.encoder.encode("AODVNUASDNVVAOVF")}async encrypt(e){const t=await window.crypto.subtle.importKey("raw",this.key,"AES-CBC",!1,["encrypt"]),i=this.utils.str2ab(e),r=await window.crypto.subtle.encrypt({name:"AES-CBC",iv:this.iv},t,i);return btoa(this.utils.ab2str(r))}async decrypt(e){const t=await window.crypto.subtle.importKey("raw",this.key,"AES-CBC",!1,["decrypt"]),i=this.utils.str2ab(atob(e)),r=await window.crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv},t,i);return this.utils.ab2str(r)}};s=__decorate([(0,r.k)({global:!0}),__metadata("design:paramtypes",[n.A])],s);const a=s},35999:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(65360),n=i(27291),s=i(16126),a=i(81160),__decorate=function(e,t,i,r){var n,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(s<3?n(a):s>3?n(t,i,a):n(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let o=class InteractionService{constructor(){this.interactionSubject=new n.B,this.interactions$=this.interactionSubject.asObservable()}getInteractions(e){return this.interactions$.pipe((0,s.p)((t=>t instanceof e)),(0,a.T)((e=>e)))}emit(e){console.debug("Interaction sent",e),this.interactionSubject.next(e)}};o=__decorate([(0,r.k)({global:!0}),__metadata("design:paramtypes",[])],o);const c=o},75015:(e,t,i)=>{i.d(t,{HB:()=>VideoReadyInteraction,Hc:()=>VideoEndInteraction,Pm:()=>TabClickedInteraction,SB:()=>VideoPlayingInteraction,Ym:()=>VideoPauseInteraction,fy:()=>AudioPauseInteraction,gY:()=>VideoMaximizedInteraction,nz:()=>ActivityResetInteraction,pK:()=>AudioPlayInteraction,ro:()=>AudioStopInteraction,s9:()=>VideoMinimizedInteraction,sV:()=>ActivityCheckInteraction,uX:()=>VideoPlayInteraction,yz:()=>ActivityFinishedInteraction});class Interaction{constructor(e){this._widgetId=e.id,this._widgetType=e.type,this._widgetDescription=e.description}get id(){return this._widgetId}get type(){return this._widgetType}get description(){return this._widgetDescription}}class ActivityResetInteraction extends Interaction{}class ActivityCheckInteraction extends Interaction{constructor(e){super(e),this._score=e.score}get score(){return this._score}}class ActivityFinishedInteraction extends Interaction{}class TabClickedInteraction extends Interaction{constructor(e){super(e),this._tab=e.tab}get tab(){return this._tab}}class AudioPlayInteraction extends Interaction{}class AudioPauseInteraction extends Interaction{}class AudioStopInteraction extends Interaction{}class VideoInteraction extends Interaction{constructor(e){super(e),this._time=e.time,this._duration=e.duration}get time(){return this._time}get duration(){return this._duration}}class VideoPlayInteraction extends VideoInteraction{}class VideoPlayingInteraction extends VideoInteraction{}class VideoEndInteraction extends VideoInteraction{}class VideoPauseInteraction extends VideoInteraction{}class VideoReadyInteraction extends Interaction{}class VideoMaximizedInteraction extends Interaction{}class VideoMinimizedInteraction extends Interaction{}},89791:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(65360),n=i(7979),s=i(83034),__decorate=function(e,t,i,r){var n,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(s<3?n(a):s>3?n(t,i,a):n(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let a=class ModalService{constructor(e,t){this.bootstrap=e,this.i18n=t}async show(e){const t=await this.bootstrap.loadModalModule(),i=document.getElementById("sharedModal"),r=t.getOrCreateInstance(i);r.hide();const onHidden=()=>{i.innerHTML="",i.removeEventListener("hidden.bs.modal",onHidden)};i.addEventListener("hidden.bs.modal",onHidden),i.innerHTML=e,r.show()}async error(e){const{default:t}=await i.e(25628).then(i.t.bind(i,25628,23)),r=t({message:e});await this.show(r)}async loading(e){const{default:t}=await i.e(69322).then(i.t.bind(i,69322,23)),r=t({message:e});await this.show(r)}async hide(){const e=await this.bootstrap.loadModalModule(),t=document.getElementById("sharedModal");e.getOrCreateInstance(t).hide()}};a=__decorate([(0,r.k)({global:!0}),__metadata("design:paramtypes",[n.A,s.A])],a);const o=a},26240:(e,t,i)=>{i.d(t,{default:()=>d});var r=i(65360),n=i(35999),s=i(93113),a=i(7885),o=i(89791),c=i(83034),__decorate=function(e,t,i,r){var n,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(s<3?n(a):s>3?n(t,i,a):n(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let l=class ObjectivesLTIService extends s.default{constructor(e,t,i,r){super(e),this.interaction=e,this.auth=t,this.modal=i,this.i18n=r,this.OBJECTIVES_URL="https://indiegateway.upct.es/api/objetivo/"}async fromServer(){var e,t;if(!this.auth.currentUser)throw await this.modal.error(this.i18n.value("modal.error.lti.401")),new Error("User not logged in");await this.modal.loading(this.i18n.value("modal.loading.objectives"));const i=await fetch(this.OBJECTIVES_URL+"objetivos",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+(null===(e=this.auth.currentUser)||void 0===e?void 0:e.access_token)}});if(this.modal.hide(),!i.ok){switch(i.status){case 400:await this.modal.error(this.i18n.value("modal.error.lti.400"));break;case 401:case 403:await this.modal.error(this.i18n.value("modal.error.lti.401"));break;default:await this.modal.error(this.i18n.value("modal.error.lti.default"))}throw new Error("Error getting objectives")}return null!==(t=(await i.json()).objetivos)&&void 0!==t?t:[]}async storeCompletedObjective(e){if(!this.auth.currentUser)throw await this.modal.error(this.i18n.value("modal.error.lti.401")),new Error("User not logged in");const t=await fetch(this.OBJECTIVES_URL+"completeObjective",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.auth.currentUser.access_token},body:JSON.stringify(e)});if(!t.ok){switch(t.status){case 400:await this.modal.error(this.i18n.value("modal.error.lti.400"));break;case 401:case 403:await this.modal.error(this.i18n.value("modal.error.lti.401"));break;default:await this.modal.error(this.i18n.value("modal.error.lti.default"))}throw new Error("Error storing objective")}}};l=__decorate([(0,r.k)({global:!0}),__metadata("design:paramtypes",[n.A,a.default,o.A,c.A])],l);const d=l},93113:(e,t,i)=>{i.d(t,{default:()=>c});var r=i(65360),n=i(75015),s=i(27291),a=i(35999),__decorate=function(e,t,i,r){var n,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(s<3?n(a):s>3?n(t,i,a):n(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let o=class ObjectivesService{constructor(e){this.interaction=e,this.objectivesSubject=new s.B,this.objectivesEvent$=this.objectivesSubject.asObservable(),e.getInteractions(n.Pm).subscribe((e=>{this.objectivesSubject.next({id:e.id+e.tab,type:e.type,description:e.description})})),e.getInteractions(n.yz).subscribe((e=>{this.objectivesSubject.next({id:e.id,type:e.type,description:e.description})})),e.getInteractions(n.pK).subscribe((e=>{this.objectivesSubject.next({id:e.id,type:e.type,description:e.description})})),e.getInteractions(n.Hc).subscribe((e=>{this.objectivesSubject.next({id:e.id,type:e.type,description:e.description})}))}get events(){return this.objectivesEvent$}};o=__decorate([(0,r.k)({global:!0}),__metadata("design:paramtypes",[a.A])],o);const c=o},34745:(e,t,i)=>{i.d(t,{default:()=>m});var r=i(65360),n=i(7979),s=i(25715),a=i(27291),o=i(75015),c=i(35999),__decorate=function(e,t,i,r){var n,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(s<3?n(a):s>3?n(t,i,a):n(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let l=class VideoAnalyticsService{constructor(e){this.PAUSE_THRESHOLD=2,this.analyticsSubject=new a.B,this.analyticsEvent$=this.analyticsSubject.asObservable(),this.ranges={},e.getInteractions(o.SB).subscribe((e=>{if(this.ranges[e.id]||(this.ranges[e.id]=[]),0==this.ranges[e.id].length)return void this.ranges[e.id].push({start:e.time,end:e.time});const t=this.ranges[e.id][this.ranges[e.id].length-1];Math.abs(t.end-e.time)>.5?this.ranges[e.id].push({start:e.time,end:e.time}):t.end=e.time})),e.getInteractions(o.Ym).subscribe((e=>{if(!this.ranges[e.id]||!this.ranges[e.id].length)return;const t=this.ranges[e.id][this.ranges[e.id].length-1],i=e.time;Math.abs(t.end-i)>this.PAUSE_THRESHOLD||(this.analyticsSubject.next({id:e.id,type:e.type,title:e.description,duration:e.duration,ranges:this.ranges[e.id]}),this.ranges[e.id]=[])})),e.getInteractions(o.Hc).subscribe((e=>{this.ranges[e.id]&&this.ranges[e.id].length&&(this.analyticsSubject.next({id:e.id,type:e.type,title:e.description,duration:e.duration,ranges:this.ranges[e.id]}),this.ranges[e.id]=[])}))}get events(){return this.analyticsEvent$}};l=__decorate([(0,r.k)({global:!0}),__metadata("design:paramtypes",[c.A])],l);const d=l;var u;!function(e){e.LOG_IN="LoggedIn",e.LOG_OUT="LoggedOut",e.KEEP_ALIVE="KeepAlive",e.VIDEO_INTERACTION="Interaction",e.OBJECTIVE_COMPLETED="Objective"}(u||(u={}));var h=i(7885),f=i(89791),p=i(83034),analytics_lti_service_decorate=function(e,t,i,r){var n,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(s<3?n(a):s>3?n(t,i,a):n(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a},analytics_lti_service_metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let b=class AnalyticsLTIService{constructor(e,t,i){this.auth=e,this.modal=t,this.i18n=i,this.ANALYTICS_URL="https://indiegateway.upct.es/api/la/private/content"}async send(e,t){const i=this.auth.currentUser;if(!i)throw await this.modal.error(this.i18n.value("modal.error.lti.401")),new Error("User not logged in");if(!i.analytics)return void console.warn("Analytics not enabled for this unit: ",e,t);const r={"Content-Type":"application/json",Authorization:"Bearer "+i.access_token},n=await fetch(this.ANALYTICS_URL,{method:"POST",headers:r,body:JSON.stringify({...t,type:e})});if(!n.ok){switch(n.status){case 400:await this.modal.error(this.i18n.value("modal.error.lti.400"));break;case 401:case 403:await this.modal.error(this.i18n.value("modal.error.lti.401"));break;default:await this.modal.error(this.i18n.value("modal.error.lti.default"))}throw new Error("Error sending analytics")}}async logIn(e){return this.send(u.LOG_IN,e)}async logOut(e){return this.send(u.LOG_OUT,e)}async keepAlive(e){return this.send(u.KEEP_ALIVE,e)}async videoInteraction(e){return this.send(u.VIDEO_INTERACTION,e)}async objectiveCompleted(e){return this.send(u.OBJECTIVE_COMPLETED,e)}};b=analytics_lti_service_decorate([(0,r.k)({global:!0}),analytics_lti_service_metadata("design:paramtypes",[h.default,f.A,p.A])],b);const y=b;var v=i(26240),progress_interoperability_service_decorate=function(e,t,i,r){var n,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(s<3?n(a):s>3?n(t,i,a):n(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a},progress_interoperability_service_metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let g=class ProgressInteroperabilityService extends s.default{constructor(e,t,i,r){super(e,t),this.objService=e,this.bootstrap=t,this.videoAnalytics=i,this.analytics=r}async resume(){this.keepAliveIntervalId||(this.keepAliveIntervalId=setInterval((()=>this.keepAlive()),6e5));const e=this.serverObjectives.reduce(((e,t)=>e+t.superado),0)/this.serverObjectives.length;await this.analytics.logIn({percentage:e})}async pause(){this.keepAliveIntervalId&&clearInterval(this.keepAliveIntervalId),this.keepAliveIntervalId=null;const e=this.serverObjectives.reduce(((e,t)=>e+t.superado),0)/this.serverObjectives.length;this.analytics.logOut({percentage:e})}async keepAlive(){const e=this.serverObjectives.reduce(((e,t)=>e+t.superado),0)/this.serverObjectives.length;await this.analytics.keepAlive({percentage:e})}async init(){await super.init(),this.serverObjectives=await this.objService.fromServer(),this.serverObjectives.forEach((e=>{const t=this.objectives[e.posicion].find((t=>t.id===e.nombre));t&&(t.percentage=e.superado||0,100===e.superado&&this.markObjectiveAsCompleted(e.nombre))})),this.redraw(),this.videoAnalytics.events.subscribe((async e=>{const t=this.serverObjectives.reduce(((e,t)=>e+t.superado),0)/this.serverObjectives.length;await this.analytics.videoInteraction({description:e.title,element:`objetivo${e.id}`,notes:JSON.stringify({video:[{Type:"Range",Ranges:e.ranges,Duration:e.duration}]}),percentage:t})})),this.objService.events.subscribe((async e=>{const t="objetivo"+e.id,i=this.objectives.flat().find((e=>e.id===t));if(!i)return;if(100==i.percentage)return;i.percentage=100,this.markObjectiveAsCompleted(t),this.redraw();const r=this.serverObjectives.find((e=>e.nombre===t));await this.objService.storeCompletedObjective(r);const n=this.objectives.flat().reduce(((e,t)=>e+t.percentage),0)/this.objectives.flat().length;await this.analytics.objectiveCompleted({percentage:n,element:t,notes:e.type,description:e.description})})),document.addEventListener("visibilitychange",(async()=>{"hidden"===document.visibilityState?await this.pause():await this.resume()})),this.resume(),console.debug("[Progress] Initialized")}};g=progress_interoperability_service_decorate([(0,r.k)({global:!0}),progress_interoperability_service_metadata("design:paramtypes",[v.default,n.A,d,y])],g);const m=g},25715:(e,t,i)=>{i.d(t,{default:()=>o});var r=i(65360),n=i(93113),s=i(7979),__decorate=function(e,t,i,r){var n,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(s<3?n(a):s>3?n(t,i,a):n(t,i))||a);return s>3&&a&&Object.defineProperty(t,i,a),a},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let a=class ProgressService{constructor(e,t){this.objService=e,this.bootstrap=t}markObjectiveAsCompleted(e){const t=document.getElementById(e);t&&(t.classList.add("fas"),t.classList.remove("far"))}redraw(){requestAnimationFrame((()=>{this.progressBars.forEach(((e,t)=>{if(!(0!=this.objectives[t].length))return e.innerHTML="",e.setAttribute("aria-valuenow","100"),void(e.style.width="100%");const i=Math.floor(this.objectives[t].reduce(((e,t)=>e+t.percentage),0)/this.objectives[t].length);e.innerHTML=`${i}%`,e.setAttribute("aria-valuenow",i.toString()),e.style.width=`${i}%`}))}))}async initMenu(){await this.bootstrap.loadCollapseModule(),this.redraw()}async init(){this.progressMenu=document.querySelector("#progreso_mp"),this.progressBars=Array.from(document.querySelectorAll(".progress-bar")),this.objectives=Array.from(document.querySelectorAll("section.container")).map((e=>Array.from(e.querySelectorAll(".objective")).map((e=>({id:e.id,percentage:0})))))}};a=__decorate([(0,r.k)({global:!0}),__metadata("design:paramtypes",[n.default,s.A])],a);const o=a}}]);