"use strict";(self.webpackChunkCDN=self.webpackChunkCDN||[]).push([[4115,7523],{72328:(t,e,i)=>{i.r(e),i.d(e,{default:()=>y});var s=i(16492),n=i(75015),o=i(73938),r=i(16126),c=i(7979),a=i(97523),h=i(44295),d=i(35999),u=i(11867),l=i(70583),f=i(61709),p=i(20427),g=i.n(p),__decorate=function(t,e,i,s){var n,o=arguments.length,r=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(r=(o<3?n(r):o>3?n(e,i,r):n(e,i))||r);return o>3&&r&&Object.defineProperty(e,i,r),r},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},__awaiter=function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function fulfilled(t){try{step(s.next(t))}catch(t){o(t)}}function rejected(t){try{step(s.throw(t))}catch(t){o(t)}}function step(t){t.done?n(t.value):function adopt(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((s=s.apply(t,e||[])).next())}))};let m=class PuzzleGamificationElement extends u.A{constructor(t,e,i,s,n,o){super(t,e,s,n),this.utils=t,this.bootstrap=e,this.interaction=i,this.voiceControl=s,this.i18n=n,this.gamification=o}clipRect(t,e,i,s){const n=t.getImageData(e.x,e.y,e.w,e.h),o=document.createElement("canvas");o.width=e.w,o.height=e.h;return o.getContext("2d").putImageData(n,0,0),t.fillRect(e.x,e.y,e.w,e.h),g()({alt:e.altImg,id:i,pos:s,url:o.toDataURL()})}onImageLoaded(){const t=document.createElement("canvas");t.width=this.tmpImg.width,t.height=this.tmpImg.height;const e=t.getContext("2d",{willReadFrequently:!0});e.fillStyle="white",e.fillRect(0,0,t.width,t.height),e.drawImage(this.tmpImg,0,0),e.fillStyle="#fff",this.utils.shuffle(this.rects);const i=this.rects.map(((t,i)=>this.clipRect(e,t,this.id,i)));this.widget.querySelectorAll(".pieces-list .piece-placeholder .dropdown").forEach(((t,e)=>t.innerHTML+=i[e])),this.widget.querySelectorAll("[data-bs-toggle]").forEach((t=>this.dropDownModule.getOrCreateInstance(t))),this.layer.setAttribute("viewBox",`0 0 ${this.tmpImg.width} ${this.tmpImg.height}`),this.background.src=t.toDataURL("image/jpeg"),this.resizeSVG()}init(){const t=Object.create(null,{init:{get:()=>super.init}});return __awaiter(this,void 0,void 0,(function*(){yield t.init.call(this),this.tmpImg=new Image,this.tmpImg.onload=()=>this.onImageLoaded(),this.tmpImg.src=this.background.dataset.src,this.tmpImg.crossOrigin="anonymous",this.gamification.gamificationEvents.pipe((0,r.p)((t=>t instanceof o.an))).subscribe((t=>{const e=this.widget.querySelector(".btn-check-answer");e.checkVisibility&&(e.disabled=!0)}))}))}check(){const t=Array.from(this.widget.querySelectorAll(".piece-wrapper .piece")),e=t.filter((t=>t.dataset.pos!==t.closest(".piece-wrapper").dataset.pos)),i=(t.length-e.length)/t.length;this.interaction.emit(new n.sV({id:this.id,type:this.type,description:this.description,score:i})),1===i&&this.interaction.emit(new n.yz({id:this.id,type:this.type,description:this.description}));this.widget.querySelector(".btn-check-answer").disabled=!0}reset(){this.interaction.emit(new n.nz({id:this.id,type:this.type,description:this.description})),this.widget.querySelectorAll(".piece-wrapper, .piece-placeholder").forEach((t=>t.setAttribute("aria-dropeffect",""))),this.grabbed&&(this.grabbed.setAttribute("aria-grabbed","false"),this.grabbed=null)}};m=__decorate([(0,s.x)({selector:".widget-puzzle"}),__metadata("design:paramtypes",[l.A,c.A,d.A,f.A,h.A,a.default])],m);const y=m},97523:(t,e,i)=>{i.r(e),i.d(e,{default:()=>h});var s=i(65360),n=i(96107),o=i(94442),r=i(37115),c=i(35999),__decorate=function(t,e,i,s){var n,o=arguments.length,r=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(r=(o<3?n(r):o>3?n(e,i,r):n(e,i))||r);return o>3&&r&&Object.defineProperty(e,i,r),r},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},__awaiter=function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function fulfilled(t){try{step(s.next(t))}catch(t){o(t)}}function rejected(t){try{step(s.throw(t))}catch(t){o(t)}}function step(t){t.done?n(t.value):function adopt(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((s=s.apply(t,e||[])).next())}))};let a=class GamificationService{constructor(t){this.interaction=t,this._code="test",this._scoresHistory=[],this.gamificationSubject=new n.B,this.gamificationEvents$=this.gamificationSubject.asObservable(),this.studentsChangedSubject=new o.m(1),this.studentsChanged$=this.studentsChangedSubject.asObservable()}get gamificationEvents(){return this.gamificationEvents$}get finalScores(){const t=this.scoresHistory[this.step],e=this.students.map((e=>{const i=t.find((t=>t.id===e.id)),s=this.scoresHistory.map((t=>{var i;return(null===(i=t.find((t=>t.id===e.id)))||void 0===i?void 0:i.points)||0})).reduce(((t,e)=>t+e),0);return{id:e.id,name:e.name,time:(null==i?void 0:i.time)||0,points:(null==i?void 0:i.points)||0,correct:(null==i?void 0:i.correct)||!1,total:s}}));return e.sort(((t,e)=>e.total-t.total)),e}get scoresHistory(){return this._scoresHistory||(this._scoresHistory=JSON.parse(sessionStorage.getItem(this._code+"-scores"))||[]),this._scoresHistory}set scoresHistory(t){this._scoresHistory=t,sessionStorage.setItem(this._code+"-scores",JSON.stringify(t))}get activity(){return this._activity}set activity(t){this._activity=t}get code(){return this._code}set code(t){this._code=t}get user(){return this._user||(this._user=JSON.parse(sessionStorage.getItem(this._code+"-user"))),this._user}set user(t){this._user=t,sessionStorage.setItem(this._code+"-user",JSON.stringify(t))}get socket(){return this._socket}set socket(t){this._socket=t}get step(){return"number"!=typeof this._step&&(this._step=JSON.parse(sessionStorage.getItem(this._code+"-step"))||0),this._step}set step(t){this._step=t,sessionStorage.setItem(this._code+"-step",JSON.stringify(t))}get students(){return this._students||(this._students=JSON.parse(sessionStorage.getItem(this._code+"-students"))||[],this.studentsChangedSubject.next(this._students)),this._students.forEach((t=>{var e;return t.answered=void 0!==(null===(e=this.scoresHistory[this.step])||void 0===e?void 0:e.find((e=>e.id===t.id))),t})),this._students}set students(t){this._students=t,sessionStorage.setItem(this._code+"-students",JSON.stringify(t)),this.studentsChangedSubject.next(t)}get studentsChanged(){return this.studentsChanged$}join(){this._socket.emit("join-room",this._code,this.user.id,{username:this.user.name})}init(){return __awaiter(this,void 0,void 0,(function*(){this._socket=(0,r.io)("http://cpcdpruebas.upct.es:3000",{forceNew:!0})}))}};a=__decorate([(0,s.k)({global:!0}),__metadata("design:paramtypes",[c.A])],a);const h=a},73938:(t,e,i)=>{i.d(e,{$Y:()=>GamificationResultEvent,an:()=>GamificationTeacherStopEvent,aq:()=>GamificationTeacherFinishedEvent,tS:()=>GamificationTeacherAckEvent,wU:()=>GamificationTeacherNextActivityEvent});class GamificationEvent{}class GamificationTeacherAckEvent extends GamificationEvent{get step(){return this._step}set step(t){this._step=t}get questions(){return this._questions}set questions(t){this._questions=t}}class GamificationTeacherStopEvent extends GamificationEvent{}class GamificationResultEvent{constructor(t=[]){this._info=t}get info(){return this._info}}class GamificationTeacherNextActivityEvent extends GamificationResultEvent{}class GamificationTeacherFinishedEvent extends GamificationResultEvent{}}}]);