"use strict";(self.webpackChunkCDN=self.webpackChunkCDN||[]).push([[46262,97523],{16492:(t,e,i)=>{i.d(e,{x:()=>Widget});var o=i(7181),n=i(40561);function Widget(t){const e=o.Ay.get(n.default);return function(i){console.debug("Registering widget "+i.name+" for selector "+t.selector),e.registerWidget(t.selector,i)}}},8157:(t,e,i)=>{i.d(e,{A:()=>CouplesElement});var o=i(19412);class CouplesElement extends o.A{constructor(t,e,i,o){super(i,e,t,o),this.i18n=t,this.utils=e,this.voiceControl=i,this.alert=o,this.currentPosition=0,this.counter=0,this.couples=[],this._preload=!0}handleOptionKeydown(t){const e=t.target,i=t.key;if("Enter"===i||"Space"===i||"ArrowUp"===i||"ArrowDown"===i||"Escape"===i)if(t.preventDefault(),t.stopPropagation(),"Enter"===i||"Space"===i){const t=e.closest(".couple");this.onCoupleSelected(t)}else"Escape"===i?e.blur():"ArrowUp"!==i&&"ArrowDown"!==i||(this.currentPosition="ArrowUp"===i?this.utils.mod(this.currentPosition-1,this.buttons.length):this.utils.mod(this.currentPosition+1,this.buttons.length),this.buttons.forEach(((t,e)=>t.setAttribute("tabindex",e===this.currentPosition?"0":"-1"))),this.buttons[this.currentPosition].focus())}async init(){await super.init(),this.widget.addEventListener("keydown",(t=>{t.target instanceof HTMLElement&&t.target.closest(".couple")&&this.handleOptionKeydown(t)})),this.widget.addEventListener("click",(t=>{t.target instanceof HTMLElement&&(t.target.classList.contains("btn-reset")?this.reset():t.target.closest(".couple")&&this.onCoupleSelected(t.target.closest(".couple")))}))}voiceControlStart(){super.voiceControlStart(),this.voiceControlGoto(0)}voiceControlCheck(){this.check()}voiceControlGoto(t){this.currentPosition=this.utils.mod(t,this.buttons.length),this.buttons[this.currentPosition].focus()}voiceControlNext(){this.voiceControlGoto(this.currentPosition+1)}voiceControlPrevious(){this.voiceControlGoto(this.currentPosition-1)}voiceControlRepeat(){this.alert.info(this.i18n.vc.value("info.couples"))}voiceControlReset(){this.reset()}voiceControlSelect(){this.buttons[this.currentPosition].click()}}},46262:(t,e,i)=>{i.r(e),i.d(e,{default:()=>g});var o=i(16492),n=i(16126),s=i(75015),r=i(73938),c=i(8157),a=i(97523),l=i(35999),h=i(70583),u=i(61709),d=i(48483),p=i(50667),v=i(83034),__decorate=function(t,e,i,o){var n,s=arguments.length,r=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(r=(s<3?n(r):s>3?n(e,i,r):n(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let f=class CouplesGamificationElement extends c.A{constructor(t,e,i,o,n,s,r){super(t,e,o,r),this.i18n=t,this.utils=e,this.interaction=i,this.voiceControl=o,this.gamification=n,this.contentService=s,this.alert=r,this.positions=[],this.pairs=[]}check(){const t=this.pairs.map((t=>this.positions[t[0]]===this.positions[t[1]])),e=t.reduce(((t,e)=>t+(e?1:0)),0)/t.length;this.interaction.emit(new s.sV({id:this.id,type:this.type,description:this.description,score:e})),1==e&&this.interaction.emit(new s.yz({id:this.id,type:this.type,description:this.description}));this.widget.querySelector(".btn-check-answer").disabled=!0}onCoupleSelected(t){if(t.classList.contains("matched"))return;const e=t.classList.contains("active"),i=Array.from(this.widget.querySelectorAll(".couple.active")).find((e=>e!==t));if(t.classList.toggle("active",!e),t.querySelector(".couple-state").innerHTML=e?"":this.i18n.value("common.selected"),i){this.counter++;const e=[i,t];e.forEach((t=>{t.querySelector(".couple-tag").innerHTML=this.counter.toString(),t.classList.remove("active"),t.querySelector(".couple-button").setAttribute("aria-disabled","true"),t.classList.add("matched")})),e[0].querySelector(".couple-state").innerHTML=this.i18n.value("couples.matched",{option:e[1].querySelector(".couple-prefix").textContent}),e[1].querySelector(".couple-state").innerHTML=this.i18n.value("couples.matched",{option:e[0].querySelector(".couple-prefix").textContent});const o=Array.from(this.widget.querySelectorAll(".couple"));this.pairs.push([o.indexOf(e[0]),o.indexOf(e[1])])}}reset(){this.interaction.emit(new s.nz({id:this.id,type:this.type,description:this.description})),this.counter=0,this.pairs=[],this.widget.querySelectorAll(".couple").forEach((t=>{t.classList.remove("active","matched"),t.querySelector(".couple-button").setAttribute("aria-disabled","false"),t.querySelector(".couple-state").innerHTML="",t.querySelector(".couple-tag").innerHTML=""}))}async init(){await super.init();const{default:t}=await i.e(28310).then(i.t.bind(i,28310,23)),e=(await this.contentService.get(this.id)).map(((t,e)=>[t,Math.floor(e/2)]));this.utils.shuffle(e),this.positions=e.map((t=>t[1])),this.couples=e.map((t=>t[0]));const o=this.couples.map(((e,i)=>{const o=this.i18n.value("common.option")+" "+(i+1)+" "+this.i18n.value("img"===e.type?"common.image":"common.text"),n={id:this.id,position:i,type:e.type,showFeedback:!1,prefix:o};if("text"===e.type){const t=document.createElement("div");t.innerHTML=e.content;const i=t.firstChild;n.hasCode=i instanceof HTMLElement&&("code"===i.tagName||i.querySelector("code")),n.content=e.content}else"img"===e.type&&(n.src=e.src,n.alt=e.alt);return t(n)})).join("");this.widget.querySelector(".couples").innerHTML+=o,this.buttons=Array.from(this.widget.querySelectorAll(".couple-button")),this.widget.addEventListener("click",(t=>{t.target.classList.contains("btn-check-answer")&&this.check()})),this.gamification.gamificationEvents.pipe((0,n.p)((t=>t instanceof r.an))).subscribe((t=>{const e=this.widget.querySelector(".btn-check-answer");e.checkVisibility&&(e.disabled=!0)})),console.debug("[Couples] Initialized")}};f=__decorate([(0,o.x)({selector:".widget-couples"}),__metadata("design:paramtypes",[v.A,h.A,l.A,u.A,a.default,d.A,p.A])],f);const g=f},19412:(t,e,i)=>{i.d(e,{A:()=>Element});var o=i(16126),n=i(3605);class Element{constructor(t,e,i,o){this.voiceControl=t,this.utils=e,this.i18n=i,this.alert=o,this._activityNumber=0,this._preload=!1}async init(){if(!this._widget)throw new Error("ElementHTML widget has not been set.");this.voiceControlButton&&(this.voiceControlButton.addEventListener("click",(()=>{if(this.voiceControl.currentTarget!==this.id){for(;this.voiceControl.numTargets>1;)this.voiceControl.popTarget();return this._parent&&this.voiceControl.addTarget(this._parent.id),void this.voiceControl.addTarget(this.id)}this.voiceControl.popTarget(),this.voiceControlButton&&this.toggleVoiceControlButton(!1)})),this.voiceControl.voiceControlTargetChanged.subscribe((t=>{this.id===t.old&&this.toggleVoiceControlButton(!1),this.id===t.new&&this.toggleVoiceControlButton(!0)})),this.voiceControl.voiceControlActions.pipe((0,o.p)((t=>t.target===this.id))).subscribe((t=>{console.debug(`[Element] Element with ${this.id} received voice action:`,t),t instanceof n.m6?this.voiceControlStart():t instanceof n.$q?this.voiceControlFinish():t instanceof n.DZ?this.voiceControlNext():t instanceof n.vZ?this.voiceControlPrevious():t instanceof n.Fd?this.voiceControlGoto(t.position):t instanceof n.V3?this.voiceControlBack():t instanceof n.gZ?this.voiceControlSelect():t instanceof n.CG?this.voiceControlClose():t instanceof n.sT?this.voiceControlCheck():t instanceof n.XR?this.voiceControlCurrent():t instanceof n.B$?this.voiceControlDelete():t instanceof n._R?this.voiceControlMaximize():t instanceof n.EZ?this.voiceControlMinimize():t instanceof n.$V?this.voiceControlMove(t.position):t instanceof n.ow?this.voiceControlPause():t instanceof n.OR?this.voiceControlPlay():t instanceof n.pr?this.voiceControlRepeat():t instanceof n.lR?this.voiceControlReset():t instanceof n.m6?this.voiceControlStart():t instanceof n.o3?this.voiceControlStop():t instanceof n.HU?this.voiceControlWrite(t.text):t instanceof n.kw&&this.voiceControlUnknown()})))}get description(){return this.widget.dataset.desc||""}get id(){return this.widget.id}get type(){return this.widget.dataset.type||""}get widget(){return this._widget}set widget(t){this._widget=t}get parent(){return this._parent}set parent(t){this._parent=t}get preload(){return this._preload}get voiceControlButton(){return this._voiceControlButton||(this._voiceControlButton=document.querySelector(`#speech-to-action-${this.id}`)),this._voiceControlButton}set activityNumber(t){this._activityNumber=t,this.voiceControlButton&&(this.voiceControlButton.innerHTML+=`<span class="element-number">${this.i18n.value("activity-number",{num:t})}</span>`)}toggleHighlight(t){this.widget.classList.toggle("speech-focused",t)}toggleVoiceControlButton(t){if(this.voiceControlButton){const e=this.voiceControlButton.querySelector("svg");e&&(e.classList.toggle("fa-head-side-cough",t),e.classList.toggle("fa-head-side-cough-slash",!t))}}showVoiceControlButton(){this.voiceControlButton&&this.voiceControlButton.classList.add("show")}hideVoiceControlButton(){this.voiceControlButton&&this.voiceControlButton.classList.remove("show")}voiceControlStart(){this.toggleVoiceControlButton(!0)}voiceControlFinish(){this.voiceControl.popTarget(),this.toggleVoiceControlButton(!1)}voiceControlClose(){this.voiceControlUnknown()}voiceControlCheck(){this.voiceControlUnknown()}voiceControlCurrent(){this.voiceControlUnknown()}voiceControlDelete(){this.voiceControlUnknown()}voiceControlMaximize(){this.voiceControlUnknown()}voiceControlMinimize(){this.voiceControlUnknown()}voiceControlMove(t){this.voiceControlUnknown()}voiceControlPause(){this.voiceControlUnknown()}voiceControlPlay(){this.voiceControlUnknown()}voiceControlRepeat(){this.voiceControlUnknown()}voiceControlReset(){this.voiceControlUnknown()}voiceControlStop(){this.voiceControlUnknown()}voiceControlWrite(t){this.voiceControlUnknown()}voiceControlNext(){this.voiceControlUnknown()}voiceControlPrevious(){this.voiceControlUnknown()}voiceControlGoto(t){this.voiceControlUnknown()}voiceControlBack(){this.voiceControlUnknown()}voiceControlSelect(){this.voiceControlUnknown()}voiceControlUnknown(){this.alert.danger(this.i18n.vc.value("message.error"))}}},48483:(t,e,i)=>{i.d(e,{A:()=>r});var o=i(65360),n=i(70583),__decorate=function(t,e,i,o){var n,s=arguments.length,r=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(r=(s<3?n(r):s>3?n(e,i,r):n(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let s=class ContentService{constructor(t){this.utils=t,this.loading=!1}async get(t){for(;this.loading;)await this.utils.sleep(100);if(this.content||(this.loading=!0,this.content=await fetch("./content.json").then((t=>t.json())),this.loading=!1),!this.content[t])throw new Error(`Widget ${t} not found`);return JSON.parse(this.utils.b64DecodeUnicode(this.content[t]))}};s=__decorate([(0,o.k)({global:!0}),__metadata("design:paramtypes",[n.A])],s);const r=s},97523:(t,e,i)=>{i.d(e,{default:()=>l});var o=i(65360),n=i(27291),s=i(94442),r=i(37115),c=i(35999),__decorate=function(t,e,i,o){var n,s=arguments.length,r=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(r=(s<3?n(r):s>3?n(e,i,r):n(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let a=class GamificationService{constructor(t){this.interaction=t,this._code="test",this._scoresHistory=[],this.gamificationSubject=new n.B,this.gamificationEvents$=this.gamificationSubject.asObservable(),this.studentsChangedSubject=new s.m(1),this.studentsChanged$=this.studentsChangedSubject.asObservable()}get gamificationEvents(){return this.gamificationEvents$}get finalScores(){const t=this.scoresHistory[this.step],e=this.students.map((e=>{const i=t.find((t=>t.id===e.id)),o=this.scoresHistory.map((t=>{var i;return(null===(i=t.find((t=>t.id===e.id)))||void 0===i?void 0:i.points)||0})).reduce(((t,e)=>t+e),0);return{id:e.id,name:e.name,time:(null==i?void 0:i.time)||0,points:(null==i?void 0:i.points)||0,correct:(null==i?void 0:i.correct)||!1,total:o}}));return e.sort(((t,e)=>e.total-t.total)),e}get scoresHistory(){return this._scoresHistory||(this._scoresHistory=JSON.parse(sessionStorage.getItem(this._code+"-scores"))||[]),this._scoresHistory}set scoresHistory(t){this._scoresHistory=t,sessionStorage.setItem(this._code+"-scores",JSON.stringify(t))}get activity(){return this._activity}set activity(t){this._activity=t}get code(){return this._code}set code(t){this._code=t}get user(){return this._user||(this._user=JSON.parse(sessionStorage.getItem(this._code+"-user"))),this._user}set user(t){this._user=t,sessionStorage.setItem(this._code+"-user",JSON.stringify(t))}get socket(){return this._socket}set socket(t){this._socket=t}get step(){return"number"!=typeof this._step&&(this._step=JSON.parse(sessionStorage.getItem(this._code+"-step"))||0),this._step}set step(t){this._step=t,sessionStorage.setItem(this._code+"-step",JSON.stringify(t))}get students(){return this._students||(this._students=JSON.parse(sessionStorage.getItem(this._code+"-students"))||[],this.studentsChangedSubject.next(this._students)),this._students.forEach((t=>{var e;return t.answered=void 0!==(null===(e=this.scoresHistory[this.step])||void 0===e?void 0:e.find((e=>e.id===t.id))),t})),this._students}set students(t){this._students=t,sessionStorage.setItem(this._code+"-students",JSON.stringify(t)),this.studentsChangedSubject.next(t)}get studentsChanged(){return this.studentsChanged$}join(){this._socket.emit("join-room",this._code,this.user.id,{username:this.user.name})}async init(){this._socket="MISSING_ENV_VAR".GAMIFICATION_SERVER?(0,r.io)("MISSING_ENV_VAR".GAMIFICATION_SERVER,{forceNew:!0}):(0,r.io)({forceNew:!0})}};a=__decorate([(0,o.k)({global:!0}),__metadata("design:paramtypes",[c.A])],a);const l=a},73938:(t,e,i)=>{i.d(e,{$Y:()=>GamificationResultEvent,an:()=>GamificationTeacherStopEvent,aq:()=>GamificationTeacherFinishedEvent,tS:()=>GamificationTeacherAckEvent,wU:()=>GamificationTeacherNextActivityEvent});class GamificationEvent{}class GamificationTeacherAckEvent extends GamificationEvent{get step(){return this._step}set step(t){this._step=t}get questions(){return this._questions}set questions(t){this._questions=t}}class GamificationTeacherStopEvent extends GamificationEvent{}class GamificationResultEvent{constructor(t=[]){this._info=t}get info(){return this._info}}class GamificationTeacherNextActivityEvent extends GamificationResultEvent{}class GamificationTeacherFinishedEvent extends GamificationResultEvent{}},35999:(t,e,i)=>{i.d(e,{A:()=>a});var o=i(65360),n=i(27291),s=i(16126),r=i(81160),__decorate=function(t,e,i,o){var n,s=arguments.length,r=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(r=(s<3?n(r):s>3?n(e,i,r):n(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let c=class InteractionService{constructor(){this.interactionSubject=new n.B,this.interactions$=this.interactionSubject.asObservable()}getInteractions(t){return this.interactions$.pipe((0,s.p)((e=>e instanceof t)),(0,r.T)((t=>t)))}emit(t){console.debug("Interaction sent",t),this.interactionSubject.next(t)}};c=__decorate([(0,o.k)({global:!0}),__metadata("design:paramtypes",[])],c);const a=c},75015:(t,e,i)=>{i.d(e,{HB:()=>VideoReadyInteraction,Hc:()=>VideoEndInteraction,Pm:()=>TabClickedInteraction,SB:()=>VideoPlayingInteraction,Ym:()=>VideoPauseInteraction,fy:()=>AudioPauseInteraction,gY:()=>VideoMaximizedInteraction,nz:()=>ActivityResetInteraction,pK:()=>AudioPlayInteraction,ro:()=>AudioStopInteraction,s9:()=>VideoMinimizedInteraction,sV:()=>ActivityCheckInteraction,uX:()=>VideoPlayInteraction,yz:()=>ActivityFinishedInteraction});class Interaction{constructor(t){this._widgetId=t.id,this._widgetType=t.type,this._widgetDescription=t.description}get id(){return this._widgetId}get type(){return this._widgetType}get description(){return this._widgetDescription}}class ActivityResetInteraction extends Interaction{}class ActivityCheckInteraction extends Interaction{constructor(t){super(t),this._score=t.score}get score(){return this._score}}class ActivityFinishedInteraction extends Interaction{}class TabClickedInteraction extends Interaction{constructor(t){super(t),this._tab=t.tab}get tab(){return this._tab}}class AudioPlayInteraction extends Interaction{}class AudioPauseInteraction extends Interaction{}class AudioStopInteraction extends Interaction{}class VideoInteraction extends Interaction{constructor(t){super(t),this._time=t.time,this._duration=t.duration}get time(){return this._time}get duration(){return this._duration}}class VideoPlayInteraction extends VideoInteraction{}class VideoPlayingInteraction extends VideoInteraction{}class VideoEndInteraction extends VideoInteraction{}class VideoPauseInteraction extends VideoInteraction{}class VideoReadyInteraction extends Interaction{}class VideoMaximizedInteraction extends Interaction{}class VideoMinimizedInteraction extends Interaction{}}}]);