"use strict";(self.webpackChunkCDN=self.webpackChunkCDN||[]).push([[26240,7885,13027,93113],{7885:(e,t,i)=>{i.d(t,{default:()=>a});var r=i(65360),n=i(13027),o=i(70583),__decorate=function(e,t,i,r){var n,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,i,s):n(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let s=class AuthService{constructor(e,t){this.cipherService=e,this.utils=t}decodeToken(e){let t=e,i=this.utils.base64UrlDecode(null==t?void 0:t.split(".")[1]).toString();return JSON.parse(i)}getTokenExpirationTimeMs(e){if(this.currentUser&&this.currentUser[e]){let t=this.currentUser[e],i=this.utils.base64UrlDecode(null==t?void 0:t.split(".")[1]).toString();return 1e3*JSON.parse(i).exp}return null}isAccessTokenExpired(){return this.isTokenExpired("access_token")}isRefreshTokenExpired(){return this.isTokenExpired("refresh_token")}isTokenExpired(e){const t=this.getTokenExpirationTimeMs(e);if(Number.isFinite(t)){return Math.floor((new Date).getTime())>=t}return!1}get currentUser(){return this._currentUser}set currentUser(e){this._currentUser=e}};s=__decorate([(0,r.k)({global:!0}),__metadata("design:paramtypes",[n.default,o.A])],s);const a=s},13027:(e,t,i)=>{i.d(t,{default:()=>s});var r=i(65360),n=i(70583),__decorate=function(e,t,i,r){var n,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,i,s):n(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let o=class CipherService{constructor(e){this.utils=e,this.encoder=new TextEncoder,this.key=this.encoder.encode("2yWfEgocFom9jbWN"),this.iv=this.encoder.encode("AODVNUASDNVVAOVF")}async encrypt(e){const t=await window.crypto.subtle.importKey("raw",this.key,"AES-CBC",!1,["encrypt"]),i=this.utils.str2ab(e),r=await window.crypto.subtle.encrypt({name:"AES-CBC",iv:this.iv},t,i);return btoa(this.utils.ab2str(r))}async decrypt(e){const t=await window.crypto.subtle.importKey("raw",this.key,"AES-CBC",!1,["decrypt"]),i=this.utils.str2ab(atob(e)),r=await window.crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv},t,i);return this.utils.ab2str(r)}};o=__decorate([(0,r.k)({global:!0}),__metadata("design:paramtypes",[n.A])],o);const s=o},35999:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(65360),n=i(27291),o=i(16126),s=i(81160),__decorate=function(e,t,i,r){var n,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,i,s):n(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let a=class InteractionService{constructor(){this.interactionSubject=new n.B,this.interactions$=this.interactionSubject.asObservable()}getInteractions(e){return this.interactions$.pipe((0,o.p)((t=>t instanceof e)),(0,s.T)((e=>e)))}emit(e){console.debug("Interaction sent",e),this.interactionSubject.next(e)}};a=__decorate([(0,r.k)({global:!0}),__metadata("design:paramtypes",[])],a);const c=a},75015:(e,t,i)=>{i.d(t,{HB:()=>VideoReadyInteraction,Hc:()=>VideoEndInteraction,Pm:()=>TabClickedInteraction,SB:()=>VideoPlayingInteraction,Ym:()=>VideoPauseInteraction,fy:()=>AudioPauseInteraction,gY:()=>VideoMaximizedInteraction,nz:()=>ActivityResetInteraction,pK:()=>AudioPlayInteraction,ro:()=>AudioStopInteraction,s9:()=>VideoMinimizedInteraction,sV:()=>ActivityCheckInteraction,uX:()=>VideoPlayInteraction,yz:()=>ActivityFinishedInteraction});class Interaction{constructor(e){this._widgetId=e.id,this._widgetType=e.type,this._widgetDescription=e.description}get id(){return this._widgetId}get type(){return this._widgetType}get description(){return this._widgetDescription}}class ActivityResetInteraction extends Interaction{}class ActivityCheckInteraction extends Interaction{constructor(e){super(e),this._score=e.score}get score(){return this._score}}class ActivityFinishedInteraction extends Interaction{}class TabClickedInteraction extends Interaction{constructor(e){super(e),this._tab=e.tab}get tab(){return this._tab}}class AudioPlayInteraction extends Interaction{}class AudioPauseInteraction extends Interaction{}class AudioStopInteraction extends Interaction{}class VideoInteraction extends Interaction{constructor(e){super(e),this._time=e.time,this._duration=e.duration}get time(){return this._time}get duration(){return this._duration}}class VideoPlayInteraction extends VideoInteraction{}class VideoPlayingInteraction extends VideoInteraction{}class VideoEndInteraction extends VideoInteraction{}class VideoPauseInteraction extends VideoInteraction{}class VideoReadyInteraction extends Interaction{}class VideoMaximizedInteraction extends Interaction{}class VideoMinimizedInteraction extends Interaction{}},89791:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(65360),n=i(7979),o=i(83034),__decorate=function(e,t,i,r){var n,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,i,s):n(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let s=class ModalService{constructor(e,t){this.bootstrap=e,this.i18n=t}async show(e){const t=await this.bootstrap.loadModalModule(),i=document.getElementById("sharedModal"),r=t.getOrCreateInstance(i);r.hide();const onHidden=()=>{i.innerHTML="",i.removeEventListener("hidden.bs.modal",onHidden)};i.addEventListener("hidden.bs.modal",onHidden),i.innerHTML=e,r.show()}async error(e){const{default:t}=await i.e(25628).then(i.t.bind(i,25628,23)),r=t({message:e});await this.show(r)}async loading(e){const{default:t}=await i.e(69322).then(i.t.bind(i,69322,23)),r=t({message:e});await this.show(r)}async hide(){const e=await this.bootstrap.loadModalModule(),t=document.getElementById("sharedModal");e.getOrCreateInstance(t).hide()}};s=__decorate([(0,r.k)({global:!0}),__metadata("design:paramtypes",[n.A,o.A])],s);const a=s},26240:(e,t,i)=>{i.d(t,{default:()=>l});var r=i(65360),n=i(35999),o=i(93113),s=i(7885),a=i(89791),c=i(83034),__decorate=function(e,t,i,r){var n,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,i,s):n(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let d=class ObjectivesLTIService extends o.default{constructor(e,t,i,r){super(e),this.interaction=e,this.auth=t,this.modal=i,this.i18n=r,this.OBJECTIVES_URL="https://indiegateway.upct.es/api/objetivo/"}async fromServer(){var e,t;if(!this.auth.currentUser)throw await this.modal.error(this.i18n.value("modal.error.lti.401")),new Error("User not logged in");await this.modal.loading(this.i18n.value("modal.loading.objectives"));const i=await fetch(this.OBJECTIVES_URL+"objetivos",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+(null===(e=this.auth.currentUser)||void 0===e?void 0:e.access_token)}});if(this.modal.hide(),!i.ok){switch(i.status){case 400:await this.modal.error(this.i18n.value("modal.error.lti.400"));break;case 401:case 403:await this.modal.error(this.i18n.value("modal.error.lti.401"));break;default:await this.modal.error(this.i18n.value("modal.error.lti.default"))}throw new Error("Error getting objectives")}return null!==(t=(await i.json()).objetivos)&&void 0!==t?t:[]}async storeCompletedObjective(e){if(!this.auth.currentUser)throw await this.modal.error(this.i18n.value("modal.error.lti.401")),new Error("User not logged in");const t=await fetch(this.OBJECTIVES_URL+"completeObjective",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.auth.currentUser.access_token},body:JSON.stringify(e)});if(!t.ok){switch(t.status){case 400:await this.modal.error(this.i18n.value("modal.error.lti.400"));break;case 401:case 403:await this.modal.error(this.i18n.value("modal.error.lti.401"));break;default:await this.modal.error(this.i18n.value("modal.error.lti.default"))}throw new Error("Error storing objective")}}};d=__decorate([(0,r.k)({global:!0}),__metadata("design:paramtypes",[n.A,s.default,a.A,c.A])],d);const l=d},93113:(e,t,i)=>{i.d(t,{default:()=>c});var r=i(65360),n=i(75015),o=i(27291),s=i(35999),__decorate=function(e,t,i,r){var n,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,i,s):n(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let a=class ObjectivesService{constructor(e){this.interaction=e,this.objectivesSubject=new o.B,this.objectivesEvent$=this.objectivesSubject.asObservable(),e.getInteractions(n.Pm).subscribe((e=>{this.objectivesSubject.next({id:e.id+e.tab,type:e.type,description:e.description})})),e.getInteractions(n.yz).subscribe((e=>{this.objectivesSubject.next({id:e.id,type:e.type,description:e.description})})),e.getInteractions(n.pK).subscribe((e=>{this.objectivesSubject.next({id:e.id,type:e.type,description:e.description})})),e.getInteractions(n.Hc).subscribe((e=>{this.objectivesSubject.next({id:e.id,type:e.type,description:e.description})}))}get events(){return this.objectivesEvent$}};a=__decorate([(0,r.k)({global:!0}),__metadata("design:paramtypes",[s.A])],a);const c=a}}]);