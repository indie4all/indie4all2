"use strict";(self.webpackChunkCDN=self.webpackChunkCDN||[]).push([[5679,98663,7885,13027],{7885:(t,e,i)=>{i.d(e,{default:()=>s});var r=i(65360),n=i(13027),o=i(70583),__decorate=function(t,e,i,r){var n,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(o<3?n(a):o>3?n(e,i,a):n(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let a=class AuthService{constructor(t,e){this.cipherService=t,this.utils=e}decodeToken(t){let e=t,i=this.utils.base64UrlDecode(null==e?void 0:e.split(".")[1]).toString();return JSON.parse(i)}getTokenExpirationTimeMs(t){if(this.currentUser&&this.currentUser[t]){let e=this.currentUser[t],i=this.utils.base64UrlDecode(null==e?void 0:e.split(".")[1]).toString();return 1e3*JSON.parse(i).exp}return null}isAccessTokenExpired(){return this.isTokenExpired("access_token")}isRefreshTokenExpired(){return this.isTokenExpired("refresh_token")}isTokenExpired(t){const e=this.getTokenExpirationTimeMs(t);if(Number.isFinite(e)){return Math.floor((new Date).getTime())>=e}return!1}get currentUser(){return this._currentUser}set currentUser(t){this._currentUser=t}};a=__decorate([(0,r.k)({global:!0}),__metadata("design:paramtypes",[n.default,o.A])],a);const s=a},13027:(t,e,i)=>{i.d(e,{default:()=>a});var r=i(65360),n=i(70583),__decorate=function(t,e,i,r){var n,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(o<3?n(a):o>3?n(e,i,a):n(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let o=class CipherService{constructor(t){this.utils=t,this.encoder=new TextEncoder,this.key=this.encoder.encode("2yWfEgocFom9jbWN"),this.iv=this.encoder.encode("AODVNUASDNVVAOVF")}async encrypt(t){const e=await window.crypto.subtle.importKey("raw",this.key,"AES-CBC",!1,["encrypt"]),i=this.utils.str2ab(t),r=await window.crypto.subtle.encrypt({name:"AES-CBC",iv:this.iv},e,i);return btoa(this.utils.ab2str(r))}async decrypt(t){const e=await window.crypto.subtle.importKey("raw",this.key,"AES-CBC",!1,["decrypt"]),i=this.utils.str2ab(atob(t)),r=await window.crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv},e,i);return this.utils.ab2str(r)}};o=__decorate([(0,r.k)({global:!0}),__metadata("design:paramtypes",[n.A])],o);const a=o},98663:(t,e,i)=>{i.d(e,{default:()=>a});var r=i(65360),n=i(7885),__decorate=function(t,e,i,r){var n,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(o<3?n(a):o>3?n(e,i,a):n(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let o=class GamificationInitiatorService{constructor(t){this.auth=t}async start(t,e,i){const r=await fetch(this.gamificationServerUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.auth.currentUser.access_token},body:JSON.stringify({idunidad:t,idwidget:e,origin:i})});if(!r.ok)return void console.error("Error starting game",r);const n="https://game.upct.es/"+(await r.json()).codgame+"/teacher/";location.replace(n)}async init(t){this.auth.canStartGamification()&&document.querySelectorAll(".btn-start-game").forEach((e=>{e.classList.remove("d-none"),e.addEventListener("click",(i=>this.start(t,e.dataset.widget,e.dataset.origin)))}))}};o=__decorate([(0,r.k)({global:!0}),__metadata("design:paramtypes",[n.default])],o);const a=o},5679:(t,e,i)=>{i.d(e,{default:()=>b});var r=i(65360),n=i(75521),o=i(40561),a=i(92652),s=i(61709),c=i(7979),l=i(70583),u=i(24971),f=i(37607),d=i(98663),h=i(7885),p=i(50667),y=i(83034),__decorate=function(t,e,i,r){var n,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(o<3?n(a):o>3?n(e,i,a):n(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let g=class OpenUnit extends n.default{constructor(t,e,i,r,n,o,a,s,c,l,u){super(t,e,i,r,n,o,a,s,u),this.factory=t,this.menu=e,this.voiceControl=i,this.bootstrap=r,this.utils=n,this.i18n=o,this.code=a,this.mathjax=s,this.auth=c,this.gInitiator=l,this.alert=u}async init(){var t,e;await this.auth.init(this.id),await super.init(),await this.gInitiator.init(this.id),localStorage.setItem("indieopenla",JSON.stringify({url:window.location.pathname,autor:document.body.dataset.author+" - "+document.body.dataset.institution}));const i=document.querySelector("#analytics .btn-link");if(i){const r=window.location.pathname.match(/(?<author>[a-z0-9]{32})(?:\/(?<unit>[a-z0-9]{32}))?/);if(r||console.debug("[AnalyticsBtn] Author and unit not found in the URL"),r){const n=new URL(i.getAttribute("href")),o=null!==(t=r.groups.author)&&void 0!==t?t:"unknown",a=null!==(e=r.groups.unit)&&void 0!==e?e:this.id;n.searchParams.set("authorid",o),n.searchParams.set("unitid",a),console.debug("[AnalyticsBtn] Author and unit found in the URL",o,a),i.setAttribute("href",n.toString())}}}};g=__decorate([(0,r.k)(),__metadata("design:paramtypes",[o.default,a.default,s.A,c.A,l.A,y.A,u.A,f.A,h.default,d.default,p.A])],g);const b=g}}]);