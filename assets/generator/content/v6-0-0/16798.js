"use strict";(self.webpackChunkCDN=self.webpackChunkCDN||[]).push([[16798],{87035:(t,e,i)=>{i.r(e),i.d(e,{default:()=>f});var s=i(16492),r=i(75015),a=i(7979),n=i(35999),c=i(11867),l=i(70583),o=i(61709),h=i(20427),d=i.n(h),u=i(38610),p=i(16126),g=i(50667),m=i(83034),__decorate=function(t,e,i,s){var r,a=arguments.length,n=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,s);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(n=(a<3?r(n):a>3?r(e,i,n):r(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n},__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let w=class PuzzleEvaluationElement extends c.A{constructor(t,e,i,s,r,a,n){super(t,e,s,r,n),this.utils=t,this.bootstrap=e,this.interaction=i,this.voiceControl=s,this.i18n=r,this.evaluation=a,this.alert=n}clipRect(t,e,i,s){const r=t.getImageData(e.x,e.y,e.w,e.h),a=document.createElement("canvas");a.width=e.w,a.height=e.h;return a.getContext("2d").putImageData(r,0,0),t.fillRect(e.x,e.y,e.w,e.h),d()({alt:e.altImg,id:i,pos:s,url:a.toDataURL()})}onImageLoaded(){const t=document.createElement("canvas");t.width=this.tmpImg.width,t.height=this.tmpImg.height;const e=t.getContext("2d",{willReadFrequently:!0});e.fillStyle="white",e.fillRect(0,0,t.width,t.height),e.drawImage(this.tmpImg,0,0),e.fillStyle="#fff",this.utils.shuffle(this.rects);const i=this.rects.map(((t,i)=>this.clipRect(e,t,this.id,i)));this.widget.querySelectorAll(".pieces-list .piece-placeholder .dropdown").forEach(((t,e)=>t.innerHTML+=i[e])),this.widget.querySelectorAll("[data-bs-toggle]").forEach((t=>this.dropDownModule.getOrCreateInstance(t))),this.layer.setAttribute("viewBox",`0 0 ${this.tmpImg.width} ${this.tmpImg.height}`),this.background.src=t.toDataURL("image/jpeg"),this.resizeSVG(),console.debug("[Puzzle] Initialized")}async init(){await super.init(),this.evaluation.attempts.pipe((0,p.p)((t=>t.widgetId===this.id))).subscribe({next:t=>{this.widget.querySelector(".btn-check-answer").disabled=!0,this.widget.querySelector(".text-result").innerHTML=this.i18n.value("common.sent")}}),this.evaluation.get(this.id).subscribe({next:t=>{this.rects=t,this.tmpImg=new Image,this.tmpImg.onload=()=>this.onImageLoaded(),this.tmpImg.src=this.background.dataset.src,this.tmpImg.crossOrigin="anonymous"},error:t=>{this.widget.querySelector(".text-result").innerHTML=this.i18n.value("evaluation.no-data")}})}check(){const t=Array.from(this.widget.querySelectorAll(".piece-wrapper .piece")),e=new Array(this.rects.length).fill(null);t.forEach((t=>{const i=t.dataset.pos,s=parseInt(t.closest(".piece-wrapper").dataset.pos);e[s]=this.rects[i]})),this.evaluation.check(this.id,e).subscribe({next:t=>{this.interaction.emit(new r.yz({id:this.id,type:this.type,description:this.description}));this.widget.querySelector(".btn-check-answer").disabled=!0,this.widget.querySelector(".text-result").innerHTML=this.i18n.value("common.sent")},error:t=>{this.widget.querySelector(".text-result").innerHTML=this.i18n.value("evaluation.no-answer")}})}reset(){this.interaction.emit(new r.nz({id:this.id,type:this.type,description:this.description})),this.widget.querySelectorAll(".piece-wrapper, .piece-placeholder").forEach((t=>t.setAttribute("aria-dropeffect",""))),this.grabbed&&(this.grabbed.setAttribute("aria-grabbed","false"),this.grabbed=null)}};w=__decorate([(0,s.x)({selector:".widget-puzzle"}),__metadata("design:paramtypes",[l.A,a.A,n.A,o.A,m.A,u.A,g.A])],w);const f=w}}]);