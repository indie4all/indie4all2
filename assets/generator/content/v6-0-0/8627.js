"use strict";(self.webpackChunkCDN=self.webpackChunkCDN||[]).push([[8627],{81832:(e,t,i)=>{i.r(t),i.d(t,{default:()=>f});var r=i(16492),s=i(75015),c=i(7979),n=i(44295),o=i(35999),a=i(11867),l=i(70583),h=i(61709),p=i(20427),d=i.n(p),__decorate=function(e,t,i,r){var s,c=arguments.length,n=c<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(n=(c<3?s(n):c>3?s(t,i,n):s(t,i))||n);return c>3&&n&&Object.defineProperty(t,i,n),n},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__awaiter=function(e,t,i,r){return new(i||(i=Promise))((function(s,c){function fulfilled(e){try{step(r.next(e))}catch(e){c(e)}}function rejected(e){try{step(r.throw(e))}catch(e){c(e)}}function step(e){e.done?s(e.value):function adopt(e){return e instanceof i?e:new i((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))};let u=class PuzzleContentElement extends a.A{constructor(e,t,i,r,s){super(e,t,s,i),this.utils=e,this.bootstrap=t,this.i18n=i,this.interaction=r,this.voiceControl=s}clipRect(e,t,i,r){const s=e.getImageData(t.x,t.y,t.w,t.h),c=document.createElement("canvas");c.width=t.w,c.height=t.h;return c.getContext("2d").putImageData(s,0,0),e.fillRect(t.x,t.y,t.w,t.h),d()({alt:t.altImg,id:i,pos:r,url:c.toDataURL()})}onImageLoaded(){const e=document.createElement("canvas");e.width=this.tmpImg.width,e.height=this.tmpImg.height;const t=e.getContext("2d",{willReadFrequently:!0});t.fillStyle="white",t.fillRect(0,0,e.width,e.height),t.drawImage(this.tmpImg,0,0),t.fillStyle="#fff",this.utils.shuffle(this.rects);const i=this.rects.map(((e,i)=>this.clipRect(t,e,this.id,i)));this.widget.querySelectorAll(".pieces-list .piece-placeholder .dropdown").forEach(((e,t)=>e.innerHTML+=i[t])),this.widget.querySelectorAll("[data-bs-toggle]").forEach((e=>this.dropDownModule.getOrCreateInstance(e))),this.layer.setAttribute("viewBox",`0 0 ${this.tmpImg.width} ${this.tmpImg.height}`),this.background.src=e.toDataURL("image/jpeg"),this.resizeSVG()}feedback(e){const t=Array.from(this.widget.querySelectorAll(".piece-wrapper .piece")),i=Array.from(this.widget.querySelectorAll(".piece-placeholder")).map((e=>e)).filter((e=>""===e.innerHTML));t.filter((e=>e.dataset.pos!==e.closest(".piece-wrapper").dataset.pos)).forEach(((e,t)=>i[t].append(e.closest(".dropdown")))),this.widget.querySelector(".text-result").innerHTML=this.i18n.value("TextNumberCorrect",{num:e})}init(){const e=Object.create(null,{init:{get:()=>super.init}});return __awaiter(this,void 0,void 0,(function*(){yield e.init.call(this),this.rects=Array.from(JSON.parse(this.utils.b64DecodeUnicode(this.widget.dataset.content))),this.tmpImg=new Image,this.tmpImg.onload=()=>this.onImageLoaded(),this.tmpImg.src=this.background.dataset.src,this.tmpImg.crossOrigin="anonymous"}))}check(){const e=Array.from(this.widget.querySelectorAll(".piece-wrapper .piece")),t=e.filter((e=>e.dataset.pos!==e.closest(".piece-wrapper").dataset.pos)),i=e.length-t.length,r=i/this.rects.length;this.interaction.emit(new s.sV({id:this.id,type:this.type,description:this.description,score:r})),1===r&&this.interaction.emit(new s.yz({id:this.id,type:this.type,description:this.description})),this.feedback(i)}reset(){this.interaction.emit(new s.nz({id:this.id,type:this.type,description:this.description})),this.widget.querySelectorAll(".piece-wrapper, .piece-placeholder").forEach((e=>e.setAttribute("aria-dropeffect",""))),this.grabbed&&(this.grabbed.setAttribute("aria-grabbed","false"),this.grabbed=null);const e=Array.from(this.widget.querySelectorAll(".piece-wrapper .piece"));Array.from(this.widget.querySelectorAll(".piece-placeholder")).filter((e=>""===e.innerHTML)).forEach(((t,i)=>t.append(e[i].closest(".dropdown")))),this.widget.querySelector(".text-result").innerHTML=""}};u=__decorate([(0,r.x)({selector:".widget-puzzle"}),__metadata("design:paramtypes",[l.A,c.A,n.A,o.A,h.A])],u);const f=u}}]);