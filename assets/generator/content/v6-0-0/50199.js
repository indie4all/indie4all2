"use strict";(self.webpackChunkCDN=self.webpackChunkCDN||[]).push([[50199,98663,7885,13027],{7885:(e,t,r)=>{r.d(t,{default:()=>a});var i=r(65360),n=r(13027),o=r(70583),__decorate=function(e,t,r,i){var n,o=arguments.length,c=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(c=(o<3?n(c):o>3?n(t,r,c):n(t,r))||c);return o>3&&c&&Object.defineProperty(t,r,c),c},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let c=class AuthService{constructor(e,t){this.cipherService=e,this.utils=t}decodeToken(e){let t=e,r=this.utils.base64UrlDecode(null==t?void 0:t.split(".")[1]).toString();return JSON.parse(r)}getTokenExpirationTimeMs(e){if(this.currentUser&&this.currentUser[e]){let t=this.currentUser[e],r=this.utils.base64UrlDecode(null==t?void 0:t.split(".")[1]).toString();return 1e3*JSON.parse(r).exp}return null}isAccessTokenExpired(){return this.isTokenExpired("access_token")}isRefreshTokenExpired(){return this.isTokenExpired("refresh_token")}isTokenExpired(e){const t=this.getTokenExpirationTimeMs(e);if(Number.isFinite(t)){return Math.floor((new Date).getTime())>=t}return!1}get currentUser(){return this._currentUser}set currentUser(e){this._currentUser=e}};c=__decorate([(0,i.k)({global:!0}),__metadata("design:paramtypes",[n.default,o.A])],c);const a=c},13027:(e,t,r)=>{r.d(t,{default:()=>c});var i=r(65360),n=r(70583),__decorate=function(e,t,r,i){var n,o=arguments.length,c=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(c=(o<3?n(c):o>3?n(t,r,c):n(t,r))||c);return o>3&&c&&Object.defineProperty(t,r,c),c},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let o=class CipherService{constructor(e){this.utils=e,this.encoder=new TextEncoder,this.key=this.encoder.encode("2yWfEgocFom9jbWN"),this.iv=this.encoder.encode("AODVNUASDNVVAOVF")}async encrypt(e){const t=await window.crypto.subtle.importKey("raw",this.key,"AES-CBC",!1,["encrypt"]),r=this.utils.str2ab(e),i=await window.crypto.subtle.encrypt({name:"AES-CBC",iv:this.iv},t,r);return btoa(this.utils.ab2str(i))}async decrypt(e){const t=await window.crypto.subtle.importKey("raw",this.key,"AES-CBC",!1,["decrypt"]),r=this.utils.str2ab(atob(e)),i=await window.crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv},t,r);return this.utils.ab2str(i)}};o=__decorate([(0,i.k)({global:!0}),__metadata("design:paramtypes",[n.A])],o);const c=o},50199:(e,t,r)=>{r.d(t,{default:()=>a});var i=r(65360),n=r(98663),o=r(7885),__decorate=function(e,t,r,i){var n,o=arguments.length,c=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(c=(o<3?n(c):o>3?n(t,r,c):n(t,r))||c);return o>3&&c&&Object.defineProperty(t,r,c),c},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let c=class GamificationInitiatorOpenService extends n.default{constructor(e){super(e),this.auth=e,this.gamificationServerUrl="https://indiegateway.upct.es/api/gamification/"}};c=__decorate([(0,i.k)({global:!0}),__metadata("design:paramtypes",[o.default])],c);const a=c},98663:(e,t,r)=>{r.d(t,{default:()=>c});var i=r(65360),n=r(7885),__decorate=function(e,t,r,i){var n,o=arguments.length,c=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(c=(o<3?n(c):o>3?n(t,r,c):n(t,r))||c);return o>3&&c&&Object.defineProperty(t,r,c),c},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let o=class GamificationInitiatorService{constructor(e){this.auth=e}async start(e,t,r){const i=await fetch(this.gamificationServerUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.auth.currentUser.access_token},body:JSON.stringify({idunidad:e,idwidget:t,origin:r})});if(!i.ok)return void console.error("Error starting game",i);const n="https://game.upct.es/"+(await i.json()).codgame+"/teacher/";location.replace(n)}async init(e){this.auth.canStartGamification()&&document.querySelectorAll(".btn-start-game").forEach((t=>{t.classList.remove("d-none"),t.addEventListener("click",(r=>this.start(e,t.dataset.widget,t.dataset.origin)))}))}};o=__decorate([(0,i.k)({global:!0}),__metadata("design:paramtypes",[n.default])],o);const c=o}}]);